# AI Computer Operator (AICO)

## å®Œæ•´é¡¹ç›®æ¶æ„ä¸è®¾è®¡æ–‡æ¡£

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®åç§°

**AI Computer Operator (AICO)**

### 1.2 æ„¿æ™¯

æ„å»ºä¸€ä¸ªå®Œæ•´çš„å¼€æ”¾å¼ AI Agent å¹³å°ï¼Œè®©å¤§è¯­è¨€æ¨¡å‹èƒ½å¤Ÿé€šè¿‡æ ‡å‡†åŒ–åè®®ç›´æ¥æ“ä½œè®¡ç®—æœºï¼Œå®Œæˆç”¨æˆ·ä¸‹è¾¾çš„å„ç±»ä»»åŠ¡ã€‚ç³»ç»Ÿè¿è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œé€šè¿‡ Web UIã€SSHã€IM æœºå™¨äººç­‰å¤šç§æ–¹å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ”¯æŒå¤š Agent å±‚çº§åä½œï¼Œå…·å¤‡æ™ºèƒ½è®°å¿†å‹ç¼©èƒ½åŠ›ï¼Œä¸”æ¯ä¸€å±‚éƒ½å¯¹å¤–å¼€æ”¾æ ‡å‡†æ¥å£ï¼Œå…è®¸å¤–éƒ¨å¼€å‘è€…æ‰©å±•æ–°åŠŸèƒ½ã€‚

### 1.3 ä¸€å¥è¯æè¿°

> **AICO æ˜¯ä¸€ä¸ªè¿æ¥å¤§æ¨¡å‹ä¸æ“ä½œç³»ç»Ÿçš„å¼€æ”¾å¹³å° â€” AI çš„å¤§è„‘è´Ÿè´£æ€è€ƒå’Œåä½œï¼ŒAICO è´Ÿè´£è®©å®ƒä»¬çš„æƒ³æ³•åœ¨å®¹å™¨ä¸­å˜æˆç°å®ï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨ã€ç»ˆç«¯æˆ–èŠå¤©æœºå™¨äººéšæ—¶éšåœ°æ“æ§ä¸€åˆ‡ã€‚**

### 1.4 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ | è¯´æ˜ |
|------|------|
| **è‡ªç„¶è¯­è¨€é©±åŠ¨** | ç”¨æˆ·ç”¨è‡ªç„¶è¯­è¨€æè¿°æ„å›¾ï¼ŒAI è‡ªåŠ¨è½¬åŒ–ä¸ºæ“ä½œåºåˆ— |
| **å¤šç«¯æ¥å…¥** | Web UIã€SSH ç»ˆç«¯ã€Telegramã€Slackã€Discord ç­‰å¤šç§è®¿é—®æ–¹å¼ |
| **å¤š Agent åä½œ** | å±‚çº§åŒ– Agent å›¢é˜Ÿï¼Œæ ¹æ®ä»»åŠ¡åŠ¨æ€é€‰æ‹©ç»„ç»‡æ¨¡å¼ |
| **å®‰å…¨å¯æ§** | å®¹å™¨éš”ç¦»ã€æ“ä½œå®¡è®¡ã€æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ã€åˆ†çº§æƒé™ |
| **æ™ºèƒ½è®°å¿†** | å¯¹è¯å‹ç¼©ã€é•¿æœŸè®°å¿†ã€è‡ªåŠ¨é—å¿˜ã€è·¨ä¼šè¯æŒç»­å­¦ä¹  |
| **å¼€æ”¾å¹³å°** | æ¯ä¸€å±‚éƒ½æš´éœ²æ ‡å‡†æ¥å£ï¼Œæ”¯æŒæ’ä»¶åŒ–æ‰©å±• |
| **åäº†å°±æ‰”** | è¿è¡Œåœ¨ Docker ä¸­ï¼Œç¯å¢ƒæŸåç›´æ¥é‡å»ºï¼Œæ•°æ®ä¸ä¸¢å¤± |

### 1.5 å…¸å‹ä½¿ç”¨åœºæ™¯

```
åœºæ™¯ 1 â€” å¼€å‘è¾…åŠ© (Web UI)
  ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­: "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå…¨æ ˆåšå®¢ç³»ç»Ÿï¼Œå‰ç«¯ Next.jsï¼Œåç«¯ FastAPI"
  AI: Commander åˆ†æ â†’ åˆ†é…ç»™ Frontend Lead + Backend Lead + DevOps Lead
      â†’ å„ Lead åˆ†é… Worker å¹¶è¡Œå¼€å‘ â†’ é›†æˆæµ‹è¯• â†’ æ±‡æŠ¥ç»“æœ

åœºæ™¯ 2 â€” è¿œç¨‹è¿ç»´ (SSH)
  è¿ç»´äººå‘˜: ssh aico@server -p 2222
  > "æ£€æŸ¥æœåŠ¡å™¨ç£ç›˜ç©ºé—´ï¼Œæ¸…ç†å¤§äº 100MB çš„æ—¥å¿—æ–‡ä»¶"
  AI: æ‰§è¡Œ df â†’ find å¤§æ–‡ä»¶ â†’ åˆ—å‡ºæ¸…å• â†’ è¯·æ±‚ç¡®è®¤ â†’ æ¸…ç† â†’ æŠ¥å‘Š

åœºæ™¯ 3 â€” ç§»åŠ¨åŠå…¬ (Telegram)
  ç”¨æˆ·åœ¨æ‰‹æœº Telegram ä¸Š: "å¸®æˆ‘çœ‹ä¸€ä¸‹ staging æœåŠ¡å™¨çš„éƒ¨ç½²çŠ¶æ€"
  Bot: â³ æ­£åœ¨æ£€æŸ¥...
       âœ… æœåŠ¡æ­£å¸¸è¿è¡Œ
       ğŸ“Š CPU: 23% | å†…å­˜: 61% | ç£ç›˜: 45%
       æœ€è¿‘éƒ¨ç½²: 2å°æ—¶å‰ (v1.2.3)

åœºæ™¯ 4 â€” å›¢é˜Ÿåä½œ (Slack)
  å¼€å‘è€…åœ¨ Slack é¢‘é“: "@AICO è¿™ä¸ª Python é¡¹ç›®è·‘ä¸èµ·æ¥ï¼Œå¸®æˆ‘çœ‹çœ‹"
  Bot: (åœ¨ Thread ä¸­å±•å¼€)
       ğŸ“‹ åˆ†æé”™è¯¯æ—¥å¿—...
       ğŸ” å‘ç°é—®é¢˜: Python 3.11 ä¸å…¼å®¹ xxx åŒ…
       ğŸ”§ ä¿®å¤æ–¹æ¡ˆ: å‡çº§ xxx åˆ° 2.0 ç‰ˆæœ¬
       âš ï¸ éœ€è¦ä¿®æ”¹ requirements.txt [å…è®¸] [æ‹’ç»]
```

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 å…­å±‚å¹³å°åŒ–æ¶æ„

```
                    å¤–éƒ¨ç”¨æˆ·æ¥å…¥æ–¹å¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æµè§ˆå™¨    â”‚ SSHå®¢æˆ·ç«¯ â”‚ docker   â”‚  IM å¹³å°              â”‚
    â”‚          â”‚          â”‚ attach   â”‚  Telegram / Slack     â”‚
    â”‚          â”‚          â”‚          â”‚  Discord / é£ä¹¦       â”‚
    â”‚          â”‚          â”‚          â”‚  é’‰é’‰ / å¾®ä¿¡ / ...    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚          â”‚          â”‚                â”‚
         â–¼          â–¼          â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Docker Container                              â”‚
â”‚                                                                      â”‚
â”‚  æ¯ä¸€å±‚éƒ½å¯¹å¤–æš´éœ²æ ‡å‡†æ¥å£ï¼Œå¤–éƒ¨å¯åŸºäºä»»æ„ä¸€å±‚å¼€å‘æ‰©å±•                      â”‚
â”‚  å†…ç½®åŠŸèƒ½ = åŸºäºè‡ªèº«æ¥å£å®ç°çš„"å®˜æ–¹æ’ä»¶"                                 â”‚
â”‚  å¤–éƒ¨æ‰©å±• = åŸºäºåŒæ ·æ¥å£å®ç°çš„"ç¬¬ä¸‰æ–¹æ’ä»¶"                               â”‚
â”‚  ä¸¤è€…åœ°ä½å¹³ç­‰ï¼Œæ¥å£ä¸€è‡´                                                 â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Layer 6: Access Layer (æ¥å…¥å±‚)                                    â”‚â”‚
â”‚  â”‚   Port 3000 â†’ Web UI + IM Webhook                                â”‚â”‚
â”‚  â”‚   Port 2222 â†’ SSH Server                                         â”‚â”‚
â”‚  â”‚   stdin     â†’ CLI                                                 â”‚â”‚
â”‚  â”‚   å¼€æ”¾æ¥å£: AccessProvider / IMPlatformAdapter                    â”‚â”‚
â”‚  â”‚   å¤–éƒ¨å¯ä»¥: æ¥å…¥ä»»æ„æ–°å¹³å° (Telegram Bot / REST API / gRPC / ...)  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Layer 5: Agent Hierarchy (å±‚çº§ç®¡ç†å±‚)                              â”‚â”‚
â”‚  â”‚   Commander (1) â†’ Lead (â‰¤7) â†’ Worker (â‰¤7/Lead)                   â”‚â”‚
â”‚  â”‚   å¼€æ”¾æ¥å£: ModeDefinition / DecompositionStrategy / QualityGate  â”‚â”‚
â”‚  â”‚   å¤–éƒ¨å¯ä»¥: æ³¨å†Œæ–°æ¨¡å¼ã€æ–°è§’è‰²ã€æ–°åä½œç­–ç•¥                           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Layer 4: LLM API (å¤§æ¨¡å‹æ¥å£å±‚)                                   â”‚â”‚
â”‚  â”‚   å¼€æ”¾æ¥å£: LLMProvider / RoutingStrategy / LLMMiddleware         â”‚â”‚
â”‚  â”‚   å¤–éƒ¨å¯ä»¥: æ¥å…¥ä»»æ„å¤§æ¨¡å‹ã€è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ã€æ·»åŠ è°ƒç”¨ä¸­é—´ä»¶            â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Layer 3: Agent Core (å•ä½“ Agent å¼•æ“ + è®°å¿†å‹ç¼©)                  â”‚â”‚
â”‚  â”‚   å¼€æ”¾æ¥å£: MemoryBackend / CompressionStrategy / SecurityPolicy  â”‚â”‚
â”‚  â”‚   å¤–éƒ¨å¯ä»¥: æ›¿æ¢è®°å¿†å­˜å‚¨ã€è‡ªå®šä¹‰å‹ç¼©ç®—æ³•ã€æ·»åŠ å®‰å…¨è§„åˆ™               â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Layer 2: MCP Services (èƒ½åŠ›æœåŠ¡å±‚)                                â”‚â”‚
â”‚  â”‚   å¼€æ”¾æ¥å£: MCPServerProvider / MCPServerRegistry                 â”‚â”‚
â”‚  â”‚   å¤–éƒ¨å¯ä»¥: å¼€å‘ä»»æ„æ–° MCP Server (æ–°å·¥å…·èƒ½åŠ›)                     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Layer 1: Container OS (å®¹å™¨è¿è¡Œæ—¶)                                â”‚â”‚
â”‚  â”‚   å¼€æ”¾æ¥å£: EnvironmentProvider / ContainerManager                â”‚â”‚
â”‚  â”‚   å¤–éƒ¨å¯ä»¥: è‡ªå®šä¹‰å®¹å™¨é•œåƒã€æ³¨å†Œæ–°ç³»ç»Ÿå·¥å…·                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                      â”‚
â”‚  è´¯ç©¿æ‰€æœ‰å±‚: Plugin System (æ’ä»¶ç³»ç»Ÿ)                                  â”‚
â”‚  æŒä¹…åŒ– Volume: /workspace  /app/data  /app/config  /app/plugins     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµæ€»è§ˆ

```
ç”¨æˆ· (æµè§ˆå™¨ / SSH / Telegram / Slack / ...)
    â”‚
    â–¼
Layer 6: AccessProvider (Web UI / SSH / IM Gateway)
    â”‚ ç»Ÿä¸€ä¸º AICOCore.sendMessage()
    â–¼
Layer 5: Commander Agent
    â”‚ é€‰æ‹©æ¨¡å¼ â†’ åˆ†è§£ä»»åŠ¡ â†’ åˆ†é… Lead
    â–¼
Layer 5: Lead Agent(s)
    â”‚ ç»†åŒ–ä»»åŠ¡ â†’ åˆ†é… Worker
    â–¼
Layer 5: Worker Agent(s)
    â”‚ è°ƒç”¨å·¥å…·æ‰§è¡Œ
    â–¼
Layer 4: LLM Client â†â†’ å¤§æ¨¡å‹ API (Claude / OpenAI / Ollama)
    â”‚
    â–¼
Layer 3: Agent Core (å¾ªç¯: Think â†’ Act â†’ Observe)
    â”‚ è®°å¿†å‹ç¼© / ä¸Šä¸‹æ–‡ç®¡ç† / å®‰å…¨æ£€æŸ¥
    â–¼
Layer 2: MCP Client â†’ MCP Server(s) (Terminal / FileSystem / ...)
    â”‚
    â–¼
Layer 1: Container OS (bash / python / git / ...)
    â”‚
    â–¼
æ‰§è¡Œç»“æœé€å±‚ä¸ŠæŠ¥ â†’ Worker â†’ Lead â†’ Commander â†’ ç”¨æˆ·
```

---

## ä¸‰ã€Layer 1 â€” å®¹å™¨è¿è¡Œæ—¶

### 3.1 è®¾è®¡åŸåˆ™

```
å®¹å™¨ = AI çš„ç”µè„‘

  â†’ ä¸åŒºåˆ†å®¿ä¸»æœºå’Œæ²™ç®±ï¼ŒAI æ“ä½œçš„å°±æ˜¯è¿™ä¸ªå®¹å™¨
  â†’ åäº†å°±æ‰”: docker compose down && docker compose up
  â†’ ç”¨æˆ·æ•°æ®é€šè¿‡ Volume æŒä¹…åŒ–ï¼Œå®¹å™¨ç¯å¢ƒéšæ—¶å¯é‡å»º
  â†’ é¢„è£…ä¸°å¯Œå·¥å…·ï¼Œä¸ç”¨æ‹…å¿ƒ"è£…å¤šäº†æä¹±ç³»ç»Ÿ"
```

### 3.2 å®¹å™¨å†…éƒ¨ç»“æ„

```
/
â”œâ”€â”€ app/                          # AICO åº”ç”¨ç¨‹åº (é•œåƒå†…ç½®ï¼Œä¸å¯å˜)
â”‚   â”œâ”€â”€ packages/                 # å„åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ node_modules/
â”‚   â””â”€â”€ entrypoint.sh
â”‚
â”œâ”€â”€ app/config/  â†â”€â”€ Volume æŒ‚è½½   # ç”¨æˆ·é…ç½® (æŒä¹…åŒ–)
â”‚   â”œâ”€â”€ default.yaml
â”‚   â”œâ”€â”€ security.yaml
â”‚   â”œâ”€â”€ llm.yaml
â”‚   â”œâ”€â”€ agents.yaml
â”‚   â”œâ”€â”€ memory.yaml
â”‚   â”œâ”€â”€ access.yaml
â”‚   â””â”€â”€ modes/                    # æ¨¡å¼å®šä¹‰
â”‚
â”œâ”€â”€ app/data/    â†â”€â”€ Volume æŒ‚è½½   # åº”ç”¨æ•°æ® (æŒä¹…åŒ–)
â”‚   â”œâ”€â”€ memory.db                  # é•¿æœŸè®°å¿† (SQLite)
â”‚   â”œâ”€â”€ audit/                     # å®¡è®¡æ—¥å¿—
â”‚   â””â”€â”€ sessions/                  # ä¼šè¯å¿«ç…§
â”‚
â”œâ”€â”€ app/plugins/ â†â”€â”€ Volume æŒ‚è½½   # æ’ä»¶ç›®å½• (æŒä¹…åŒ–)
â”‚
â”œâ”€â”€ workspace/   â†â”€â”€ Volume æŒ‚è½½   # ç”¨æˆ·å·¥ä½œç›®å½• (æŒä¹…åŒ–)
â”‚
â””â”€â”€ (ç³»ç»Ÿå·¥å…·: bash, git, python, node, go, rust, docker-cli ...)
```

### 3.3 é¢„è£…å·¥å…·æ¸…å•

```
åŸºç¡€ç³»ç»Ÿ:   bash, zsh, curl, wget, jq, tree, htop, vim, nano
ç‰ˆæœ¬æ§åˆ¶:   git
ç¼–ç¨‹è¯­è¨€:   Node.js 20 + npm + pnpm + yarn
            Python 3.12 + pip + venv
            Go (latest)
            Rust (latest)
æ„å»ºå·¥å…·:   make, cmake, gcc, g++
å®¹å™¨å·¥å…·:   docker CLI (å¯é€‰ï¼Œé€šè¿‡æŒ‚è½½å®¿ä¸»æœº docker.sock)
ç½‘ç»œå·¥å…·:   ssh, scp, rsync, netcat
æ•°æ®åº“å®¢æˆ·ç«¯: sqlite3, redis-cli, psql
```

### 3.4 å®¹å™¨ç”Ÿå‘½å‘¨æœŸ

```
é¦–æ¬¡å¯åŠ¨:
  docker compose up -d
    â†’ entrypoint.sh:
      1. æ£€æŸ¥ config Volume â†’ ç©ºåˆ™å¤åˆ¶é»˜è®¤é…ç½®
      2. æ£€æŸ¥ data Volume â†’ ç©ºåˆ™åˆå§‹åŒ–æ•°æ®åº“
      3. æ£€æŸ¥ç¯å¢ƒå˜é‡ (API Key)
      4. ç”Ÿæˆ SSH ä¸»æœºå¯†é’¥ (å¦‚æœä¸å­˜åœ¨)
      5. ç”Ÿæˆ SSH å¯†ç  (å¦‚æœé…ç½®ä¸º auto)
      6. å¯åŠ¨ AICO

æ­£å¸¸ä½¿ç”¨:
  æµè§ˆå™¨ â†’ http://localhost:3000         # Web UI
  ç»ˆç«¯   â†’ ssh aico@localhost -p 2222    # SSH
  ç»ˆç«¯   â†’ docker attach aico           # CLI
  æ‰‹æœº   â†’ Telegram @YourAICOBot         # IM

ç¯å¢ƒæŸåæ¢å¤:
  docker compose down && docker compose up -d
  â†’ å®¹å™¨é‡å»ºï¼ŒVolume ä¸å˜
  â†’ è®°å¿†è¿˜åœ¨ï¼Œæ–‡ä»¶è¿˜åœ¨ï¼Œç³»ç»Ÿç¯å¢ƒå¹²å‡€

å®Œå…¨é‡ç½® (åŒ…æ‹¬è®°å¿†):
  docker compose down -v    # -v åˆ é™¤ Volume
  docker compose up -d      # ä¸€åˆ‡ä»å¤´

é•œåƒæ›´æ–°:
  docker compose pull && docker compose up -d
  â†’ Volume ä¸å˜ï¼Œåº”ç”¨å‡çº§
```

### 3.5 å¯¹å¤–æ¥å£

```
Interface: EnvironmentProvider
  getProfile(): OSProfile
    â†’ è¿”å›å½“å‰ç¯å¢ƒä¿¡æ¯ (OS/æ¶æ„/Shell/å·²è£…å·¥å…·)
  checkCapability(name: string): boolean
    â†’ æ£€æµ‹æŸé¡¹èƒ½åŠ›æ˜¯å¦å¯ç”¨
  getToolPath(name: string): string | null
    â†’ è·å–æŸå·¥å…·çš„è·¯å¾„
  registerTool(tool: ToolDefinition): void
    â†’ æ³¨å†Œä¸€ä¸ªæ–°çš„ç³»ç»Ÿå·¥å…·

Interface: ContainerManager
  getHealth(): HealthStatus
    â†’ å®¹å™¨å¥åº·çŠ¶æ€ (ç£ç›˜/å†…å­˜/CPU)
  reset(scope: "soft" | "hard"): void
    â†’ soft: æ¸…ç†ä¸´æ—¶æ–‡ä»¶ / hard: å»ºè®®ç”¨æˆ·é‡å»ºå®¹å™¨
  getVolumes(): VolumeInfo[]
    â†’ è¿”å›æŒä¹…åŒ– Volume ä¿¡æ¯

å¤–éƒ¨ç”¨é€”:
  â†’ è‡ªå®šä¹‰å®¹å™¨é•œåƒï¼Œé€šè¿‡ registerTool è®©ç³»ç»ŸçŸ¥é“æ–°å·¥å…·
  â†’ ç¯å¢ƒåˆå§‹åŒ–æ’ä»¶ (å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®)
  â†’ å¥åº·ç›‘æ§æ’ä»¶ (åŸºäº getHealth åšå‘Šè­¦)
```

---

## å››ã€Layer 2 â€” MCP èƒ½åŠ›æœåŠ¡å±‚

### 4.1 è®¾è®¡è¯´æ˜

æ‰€æœ‰ MCP Server éµå¾ªç»Ÿä¸€çš„ MCP åè®®ï¼Œä¸º AI æä¾›æ“ä½œç³»ç»Ÿçš„å„ç§èƒ½åŠ›ã€‚æ¯ä¸ª Server æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èƒ½åŠ›æ¨¡å—ï¼ŒæŒ‰éœ€å¯ç”¨ã€‚

### 4.2 MCP Terminal Serverï¼ˆæ ¸å¿ƒï¼Œä¼˜å…ˆå®ç°ï¼‰

```
MCP Terminal Server
â”‚
â”œâ”€â”€ Toolsï¼ˆå·¥å…·ï¼‰
â”‚   â”œâ”€â”€ execute_command      å¿«é€Ÿæ‰§è¡Œå•æ¡å‘½ä»¤ï¼ˆæ— çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ run_script           æ‰§è¡Œå¤šè¡Œè„šæœ¬ï¼ˆPython/Bash/Nodeï¼‰
â”‚   â”œâ”€â”€ create_session       åˆ›å»ºæŒä¹…ç»ˆç«¯ä¼šè¯
â”‚   â”œâ”€â”€ send_to_session      å‘ä¼šè¯å‘é€è¾“å…¥
â”‚   â”œâ”€â”€ read_session_output  è¯»å–ä¼šè¯è¾“å‡º
â”‚   â”œâ”€â”€ list_sessions        åˆ—å‡ºæ‰€æœ‰æ´»è·ƒä¼šè¯
â”‚   â””â”€â”€ close_session        å…³é—­ä¼šè¯
â”‚
â”œâ”€â”€ Resourcesï¼ˆèµ„æºï¼‰
â”‚   â”œâ”€â”€ terminal://sessions          å½“å‰æ´»è·ƒä¼šè¯åˆ—è¡¨
â”‚   â”œâ”€â”€ terminal://session/{id}/log  ä¼šè¯å®Œæ•´æ—¥å¿—
â”‚   â””â”€â”€ terminal://system-info       ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
â”‚
â””â”€â”€ Internalï¼ˆå†…éƒ¨æ¨¡å—ï¼‰
    â”œâ”€â”€ SecurityLayer        å®‰å…¨æ£€æŸ¥
    â”œâ”€â”€ SessionManager       ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
    â”œâ”€â”€ PTYBackend           ä¼ªç»ˆç«¯åç«¯
    â”œâ”€â”€ SubprocessBackend    å­è¿›ç¨‹åç«¯
    â”œâ”€â”€ OutputProcessor      è¾“å‡ºå¤„ç†ï¼ˆANSIæ¸…ç†/æˆªæ–­/ç¼–ç ï¼‰
    â””â”€â”€ AuditLogger          å®¡è®¡æ—¥å¿—
```

**Tool å®šä¹‰ï¼š**

```typescript
// execute_command â€” æœ€å¸¸ç”¨çš„å·¥å…·
{
  name: "execute_command",
  description: "åœ¨ shell ä¸­æ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼Œè¿”å› stdoutã€stderr å’Œé€€å‡ºç ",
  inputSchema: {
    properties: {
      command:  { type: "string",  description: "è¦æ‰§è¡Œçš„ shell å‘½ä»¤" },
      cwd:     { type: "string",  description: "å·¥ä½œç›®å½•ï¼ˆç»å¯¹è·¯å¾„ï¼‰" },
      timeout: { type: "number",  description: "è¶…æ—¶ç§’æ•°ï¼Œé»˜è®¤ 30" },
      env:     { type: "object",  description: "é¢å¤–ç¯å¢ƒå˜é‡ key-value" },
    },
    required: ["command"],
  },
  output: {
    exitCode: number,
    stdout: string,
    stderr: string,
    duration: number,
    truncated: boolean,
  }
}

// run_script â€” æ‰§è¡Œå¤šè¡Œè„šæœ¬
{
  name: "run_script",
  description: "æ‰§è¡Œä¸€æ®µè„šæœ¬ä»£ç ï¼Œå†…éƒ¨åˆ›å»ºä¸´æ—¶æ–‡ä»¶æ‰§è¡Œåè‡ªåŠ¨æ¸…ç†",
  inputSchema: {
    properties: {
      language: { type: "string", enum: ["bash","python","node","ruby","perl"] },
      code:     { type: "string", description: "è„šæœ¬ä»£ç " },
      args:     { type: "array",  description: "å‘½ä»¤è¡Œå‚æ•°" },
      cwd:      { type: "string", description: "å·¥ä½œç›®å½•" },
      timeout:  { type: "number", description: "è¶…æ—¶ç§’æ•°ï¼Œé»˜è®¤ 60" },
    },
    required: ["language", "code"],
  }
}

// ä¼šè¯ç®¡ç†å·¥å…·
// create_session   â†’ { sessionId, shell, pid }
// send_to_session  â†’ { output, isAlive }
// read_session_output â†’ { output, isAlive }
// list_sessions    â†’ { sessions: SessionInfo[] }
// close_session    â†’ { success: boolean }
```

### 4.3 å…¶ä»– MCP Serverï¼ˆåç»­æ‰©å±•ï¼‰

```
MCP FileSystem Server â€” ç»“æ„åŒ–æ–‡ä»¶æ“ä½œ
  Tools: read_file, write_file, edit_file, search_files, list_directory, get_file_info
  ä¼˜åŠ¿: edit_file ç²¾ç¡®è¡Œçº§ç¼–è¾‘ï¼Œå¤§æ–‡ä»¶åˆ†é¡µè¯»å–

MCP Browser Server â€” æµè§ˆå™¨è‡ªåŠ¨åŒ– (åŸºäº Playwright)
  Tools: open_url, click, type_text, screenshot, get_page_content, evaluate_js

MCP Desktop Server â€” GUI æ“ä½œ (åŸºäº robotjs/nut-js)
  Tools: screenshot, mouse_click, mouse_drag, keyboard_type, keyboard_shortcut
```

### 4.4 å¯¹å¤–æ¥å£

```
Interface: MCPServerProvider (æ ‡å‡† MCP åè®®)
  listTools(): ToolDefinition[]
  callTool(name: string, args: any): ToolResult
  listResources(): ResourceDefinition[]
  readResource(uri: string): ResourceContent

Interface: MCPServerRegistry
  register(server: MCPServerConfig): void
  unregister(serverId: string): void
  listServers(): MCPServerInfo[]
  getToolsByCapability(tag: string): ToolDefinition[]
    â†’ æŒ‰èƒ½åŠ›æ ‡ç­¾æŸ¥æ‰¾å·¥å…·ï¼Œä¸ç®¡æ¥è‡ªå“ªä¸ª Server

å¤–éƒ¨ç”¨é€”:
  å¼€å‘æ–°çš„ MCP Server:
    mcp-database:    ç›´æ¥æ“ä½œæ•°æ®åº“ (SQLæ‰§è¡Œ/è¡¨ç®¡ç†)
    mcp-git:         ç»“æ„åŒ– Git æ“ä½œ
    mcp-http:        HTTP è¯·æ±‚å·¥å…· (API è°ƒè¯•)
    mcp-docker:      Docker å®¹å™¨ç®¡ç†
    mcp-email:       å‘é€é‚®ä»¶
    mcp-kubernetes:  K8s é›†ç¾¤ç®¡ç†
    mcp-aws:         AWS æœåŠ¡æ“ä½œ
```

---

## äº”ã€Layer 3 â€” Agent Coreï¼ˆå•ä½“ Agent å¼•æ“ï¼‰

### 5.1 æ•´ä½“ç»“æ„

```
Agent Core (æ¯ä¸ª Agent å®ä¾‹åŒ–ä¸€ä¸ª)
â”‚
â”œâ”€â”€ AgentLoop              ä¸»å¾ªç¯ï¼šThink â†’ Act â†’ Observe â†’ å¾ªç¯
â”‚   â”œâ”€â”€ PlanningEngine     ä»»åŠ¡åˆ†è§£ä¸æ­¥éª¤è§„åˆ’
â”‚   â”œâ”€â”€ ExecutionEngine    å·¥å…·è°ƒç”¨åˆ†å‘ä¸ç»“æœæ”¶é›†
â”‚   â””â”€â”€ ReflectionEngine   è‡ªæˆ‘è¯„ä¼°ä¸é”™è¯¯ä¿®æ­£
â”‚
â”œâ”€â”€ MemorySystem           è®°å¿†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ WorkingMemory      å·¥ä½œè®°å¿†ï¼ˆå½“å‰ä»»åŠ¡çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ ShortTermMemory    çŸ­æœŸè®°å¿†ï¼ˆå¯¹è¯å†å² + å‹ç¼©ï¼‰
â”‚   â””â”€â”€ LongTermMemory     é•¿æœŸè®°å¿†ï¼ˆæŒä¹…åŒ–çŸ¥è¯†åº“ï¼‰
â”‚
â”œâ”€â”€ MemoryCompressor       è®°å¿†å‹ç¼©å¼•æ“
â”‚   â”œâ”€â”€ ZoneClassifier     ä¸‰åŒºåˆ†ç±»å™¨
â”‚   â”œâ”€â”€ SummaryGenerator   æ‘˜è¦ç”Ÿæˆå™¨ (è°ƒ LLM)
â”‚   â”œâ”€â”€ OutputSimplifier   å·¥å…·è¾“å‡ºç²¾ç®€å™¨ (è§„åˆ™)
â”‚   â””â”€â”€ DuplicateMerger    é‡å¤æ“ä½œåˆå¹¶å™¨
â”‚
â”œâ”€â”€ ConversationManager    å¯¹è¯ç®¡ç†
â”‚   â”œâ”€â”€ ContextBuilder     ä¸Šä¸‹æ–‡æ„å»º
â”‚   â””â”€â”€ TokenBudget        Token é¢„ç®—ç®¡ç†
â”‚
â”œâ”€â”€ SecurityGate           å®‰å…¨é—¨æ§
â”‚   â”œâ”€â”€ PolicyEngine       ç­–ç•¥å¼•æ“
â”‚   â””â”€â”€ AuditLogger        å®¡è®¡æ—¥å¿—
â”‚
â””â”€â”€ ImportanceScorer       é‡è¦æ€§è¯„åˆ†å™¨
    â””â”€â”€ ForgettingManager  é—å¿˜ç®¡ç†å™¨
```

### 5.2 Agent Loopï¼ˆæ ¸å¿ƒå¾ªç¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Agent Loop                         â”‚
â”‚                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚  THINK   â”‚  æ„å»ºä¸Šä¸‹æ–‡ â†’ è°ƒç”¨å¤§æ¨¡å‹ â†’ å¾—åˆ°å“åº”    â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚        â”‚                                            â”‚
â”‚        â–¼                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å“åº”ç±»å‹åˆ¤æ–­:                        â”‚
â”‚   â”‚  ROUTE   â”‚  â”œâ”€ tool_call â†’ ACT                  â”‚
â”‚   â”‚          â”‚  â”œâ”€ text_reply â†’ RESPOND              â”‚
â”‚   â”‚          â”‚  â””â”€ task_done â†’ FINISH                â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚        â”‚                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚   ACT    â”‚  å®‰å…¨æ£€æŸ¥ â†’ ç”¨æˆ·ç¡®è®¤(å¦‚éœ€)             â”‚
â”‚   â”‚          â”‚  â†’ MCP è°ƒç”¨ â†’ æ”¶é›†ç»“æœ                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚        â”‚                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚ OBSERVE  â”‚  åˆ†ææ‰§è¡Œç»“æœ â†’ æ›´æ–°å·¥ä½œè®°å¿†            â”‚
â”‚   â”‚          â”‚  â†’ æ£€æŸ¥æ˜¯å¦éœ€è¦å‹ç¼©                    â”‚
â”‚   â”‚          â”‚  â†’ åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´è®¡åˆ’                 â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚        â”‚                                            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â†’ å›åˆ° THINKï¼ˆå¾ªç¯ï¼‰                   â”‚
â”‚                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚ RESPOND  â”‚  å‘ç”¨æˆ·/ä¸Šçº§å±•ç¤ºå›å¤                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚   â”‚ FINISH   â”‚  ä»»åŠ¡å®Œæˆæ€»ç»“ â†’ æå–é•¿æœŸè®°å¿†            â”‚
â”‚   â”‚          â”‚  â†’ è§¦å‘é—å¿˜æ£€æŸ¥ â†’ æ¸…ç†èµ„æº              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒå¾ªç¯ä¼ªä»£ç ï¼š**

```typescript
class AgentLoop {
  async run(userMessage: string): Promise<void> {
    this.memory.working.setGoal(userMessage);
    let isComplete = false;

    while (!isComplete) {
      // ---- ä¸Šä¸‹æ–‡æ„å»º (èå…¥å‹ç¼©) ----
      const context = await this.buildContext();
      //   1. System Prompt (å«è§’è‰²å®šä¹‰)
      //   2. æ£€ç´¢é•¿æœŸè®°å¿† (æŒ‰ç›¸å…³æ€§æ’åº)
      //   3. å·¥ä½œè®°å¿†ç¯å¢ƒå¿«ç…§
      //   4. çŸ­æœŸè®°å¿† (å¯èƒ½å·²å‹ç¼©çš„å¯¹è¯å†å²)
      //   5. è®¡ç®—æ€» token â†’ è¶…é™åˆ™è§¦å‘å‹ç¼©
      //   6. é¢„ç•™ reserve_for_response

      // ---- THINK ----
      const response = await this.llm.chat(context);

      // ---- ROUTE + ACT ----
      if (response.hasToolCalls()) {
        for (const call of response.toolCalls) {
          const decision = await this.security.evaluate(call);
          if (decision === "deny") { this.addResult(call.id, "è¢«å®‰å…¨ç­–ç•¥æ‹¦æˆª"); continue; }
          if (decision === "confirm") {
            const approved = await this.ui.confirm(`AI æƒ³è¦æ‰§è¡Œ: ${call.name}`);
            if (!approved) { this.addResult(call.id, "ç”¨æˆ·æ‹’ç»"); continue; }
          }
          const result = await this.mcpClient.callTool(call.name, call.args);
          this.addResult(call.id, result);

          // ---- OBSERVE ----
          this.memory.working.recordAction({ tool: call.name, args: call.args, result });
        }
      }

      if (response.hasText()) { await this.ui.display(response.text); }

      // ---- å‹ç¼©æ£€æŸ¥ ----
      if (this.memory.shortTerm.tokenCount() > compressionThreshold) {
        await this.memory.shortTerm.compress();
      }

      // ---- FINISH ----
      if (response.isComplete()) {
        isComplete = true;
        const newMemories = await this.extractLongTermMemories();
        for (const mem of newMemories) { await this.memory.longTerm.save(mem); }
        this.memory.longTerm.cleanupIfNeeded(); // å¼‚æ­¥é—å¿˜æ£€æŸ¥
      }
    }
  }
}
```

### 5.3 è®°å¿†ç³»ç»Ÿ

#### 5.3.1 ä¸‰çº§è®°å¿†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1: ç§æœ‰å·¥ä½œè®°å¿† (æ¯ä¸ª Agent ç‹¬æœ‰)                      â”‚
â”‚                                                              â”‚
â”‚  å†…å®¹: å½“å‰ä»»åŠ¡ç›®æ ‡ã€æ‰§è¡Œè®¡åˆ’ã€æœ€è¿‘æ“ä½œ (æ»‘åŠ¨çª—å£)ã€ç¯å¢ƒå¿«ç…§    â”‚
â”‚  ç”Ÿå‘½å‘¨æœŸ: Agent å­˜åœ¨æœŸé—´                                     â”‚
â”‚  Commander é”€æ¯æ—¶: ä¿å­˜ä¼šè¯å¿«ç…§åˆ°æ–‡ä»¶                          â”‚
â”‚  Lead é”€æ¯æ—¶: å…³é”®ä¿¡æ¯ä¸ŠæŠ¥ Commander                           â”‚
â”‚  Worker é”€æ¯æ—¶: ä¸¢å¼ƒ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 2: çŸ­æœŸå¯¹è¯è®°å¿† (æ¯ä¸ª Agent ç‹¬æœ‰)                      â”‚
â”‚                                                              â”‚
â”‚  å†…å®¹: è¯¥ Agent ä¸ LLM çš„å¯¹è¯å†å²                             â”‚
â”‚  Token è¶…é™æ—¶: è§¦å‘å‹ç¼© (ä¸‰åŒºæ¨¡å‹)                             â”‚
â”‚  å„çº§ Agent ç‹¬ç«‹å‹ç¼©ï¼Œäº’ä¸å½±å“                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3: å…±äº«é•¿æœŸè®°å¿† (å…¨å±€å”¯ä¸€, SQLite)                     â”‚
â”‚                                                              â”‚
â”‚  å­˜å‚¨åœ¨ /app/data/memory.db (Volume æŒä¹…åŒ–)                   â”‚
â”‚  æ‰€æœ‰ Agent å¯è¯», Commander å’Œ Lead å¯å†™                      â”‚
â”‚  Worker é€šè¿‡ Lead é—´æ¥å†™å…¥                                    â”‚
â”‚  å†…å®¹: ç”¨æˆ·åå¥½ã€é¡¹ç›®çŸ¥è¯†ã€ç»éªŒæ•™è®­ã€æŠ€èƒ½æµç¨‹                   â”‚
â”‚  å®šæœŸ: é—å¿˜æ¸…ç† + ç›¸ä¼¼è®°å¿†åˆå¹¶                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.3.2 å·¥ä½œè®°å¿†

```typescript
interface WorkingMemory {
  goal: string;                       // å½“å‰ç›®æ ‡
  plan: string[];                     // åˆ†è§£çš„æ­¥éª¤
  currentStep: number;                // å½“å‰è¿›è¡Œåˆ°ç¬¬å‡ æ­¥
  recentActions: Array<{              // æœ€è¿‘æ“ä½œ (æ»‘åŠ¨çª—å£)
    tool: string;
    args: any;
    result: string;
    timestamp: number;
  }>;
  environmentSnapshot: {              // AI å¯¹å½“å‰ç¯å¢ƒçš„ç†è§£
    cwd: string;
    modifiedFiles: string[];
    createdDirectories: string[];
    installedDependencies: string[];
    runningServices: Array<{ port: number; process: string }>;
    environmentState: string;
    knownIssues: string[];
  };
}

// æ»‘åŠ¨çª—å£å¤§å° (æŒ‰ Agent çº§åˆ«)
// Commander: 30 æ¡
// Lead:      20 æ¡
// Worker:    10 æ¡

// æº¢å‡ºæ—¶çš„å¤„ç†:
//   ç»“æœå·²è¢«åç»­è¦†ç›– (æ—§çš„ ls ç»“æœå·²è¿‡æ—¶) â†’ ä¸¢å¼ƒ
//   ç»“æœä»æœ‰å‚è€ƒä»·å€¼ (ç‰ˆæœ¬å·ç­‰) â†’ æå–å…³é”®ä¿¡æ¯ï¼Œåˆå¹¶åˆ°ç¯å¢ƒå¿«ç…§
//   å®Œå…¨æ— ç”¨ (ä¸­é—´çš„ pwd) â†’ ä¸¢å¼ƒ
```

#### 5.3.3 çŸ­æœŸè®°å¿†å‹ç¼© â€” ä¸‰åŒºæ¨¡å‹

```
è§¦å‘æ¡ä»¶: å¯¹è¯å†å² token æ•° > compression_threshold

å„çº§ Agent å‚æ•°:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Agent       â”‚ ä¸Šä¸‹æ–‡çª—å£â”‚ å‹ç¼©é˜ˆå€¼        â”‚ è¿‘æœŸä¿ç•™è½®æ•°  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Commander   â”‚ 32000    â”‚ 24000          â”‚ 5            â”‚
  â”‚ Lead        â”‚ 16000    â”‚ 12000          â”‚ 3            â”‚
  â”‚ Worker      â”‚  8000    â”‚  6000          â”‚ 2            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸‰ä¸ªåŒº:

  Zone A: è¿œæœŸå†å² â†’ å‹ç¼©ä¸ºæ‘˜è¦
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    æ–¹æ³•: è°ƒç”¨ LLM æ€»ç»“
    Prompt: "æ€»ç»“ä»¥ä¸‹å¯¹è¯çš„å…³é”®ä¿¡æ¯:
      1. ä»»åŠ¡ç›®æ ‡  2. å·²å®Œæˆæ­¥éª¤
      3. å…³é”®å†³ç­–  4. æœªè§£å†³é—®é¢˜"
    æ•ˆæœ: 20 æ¡æ¶ˆæ¯ â†’ 1 æ¡æ‘˜è¦

  Zone B: ä¸­æœŸå†å² â†’ ç²¾ç®€å·¥å…·è¾“å‡º
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    æ–¹æ³•: è§„åˆ™å¤„ç† (ä¸è°ƒç”¨ LLMï¼ŒèŠ‚çœ Token)

    è§„åˆ™ 1: å¤§è¾“å‡ºæˆªæ–­
      > 500 å­—ç¬¦ â†’ ä¿ç•™é¦–å°¾å„ 200 + "...(çœç•¥ N å­—ç¬¦)"

    è§„åˆ™ 2: æˆåŠŸç»“æœç®€åŒ–
      exit 0 ä¸”åç»­æœªå¼•ç”¨ â†’ "å‘½ä»¤æˆåŠŸ (exit 0)"

    è§„åˆ™ 3: åˆ—è¡¨è¾“å‡ºèšåˆ
      ls è¿”å› 200 æ–‡ä»¶ â†’ "ç›®å½•å« 200 æ–‡ä»¶ (*.py, *.js ç­‰)"

    è§„åˆ™ 4: é‡å¤æ“ä½œåˆå¹¶
      5 æ¬¡ npm install â†’ "æ‰§è¡Œ 5 æ¬¡ npm installï¼Œæœ€ç»ˆæˆåŠŸ"

    è§„åˆ™ 5: å¤±è´¥ç»“æœå®Œæ•´ä¿ç•™
      é”™è¯¯è¾“å‡ºä¸å‹ç¼© (è°ƒè¯•éœ€è¦)

  Zone C: è¿‘æœŸå†å² â†’ å®Œæ•´ä¿ç•™
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Commander: æœ€è¿‘ 5 è½®
    Lead: æœ€è¿‘ 3 è½®
    Worker: æœ€è¿‘ 2 è½®

è¶…é™æ—¶çš„ç´§æ€¥å‹ç¼©ä¼˜å…ˆçº§:
  â‘  å‡å°‘é•¿æœŸè®°å¿†æ£€ç´¢æ•°é‡
  â‘¡ Zone B æ›´æ¿€è¿›ç²¾ç®€
  â‘¢ Zone A æ‘˜è¦å†å‹ç¼©
  â‘£ æœ€åæ‰‹æ®µ: å‡å°‘ Zone C ä¿ç•™è½®æ•°
```

#### 5.3.4 é•¿æœŸè®°å¿†

```typescript
interface MemoryEntry {
  id: string;
  type: "user_preference" | "project_knowledge" | "lesson_learned" | "skill";
  content: string;
  context: string;                    // åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å­¦åˆ°çš„
  source: string;                     // å“ªä¸ª Agent å†™å…¥çš„
  importance: number;                 // é‡è¦æ€§è¯„åˆ† 0-1
  createdAt: Date;
  lastAccessedAt: Date;
  accessCount: number;
}

// å­˜å‚¨æ–¹æ¡ˆ:
//   Phase 1: JSON æ–‡ä»¶ + å…¨æ–‡æœç´¢
//   Phase 2: SQLite + FTS5 å…¨æ–‡æœç´¢ (é»˜è®¤)
//   Phase 3: SQLite + å‘é‡åµŒå…¥ (è¯­ä¹‰æœç´¢)
```

**é‡è¦æ€§è¯„åˆ†ï¼š**

```
åˆå§‹è¯„åˆ† (å†™å…¥æ—¶):

  æ–¹å¼ A â€” LLM åˆ¤æ–­:
    Prompt: "ä»¥ä¸‹ä¿¡æ¯çš„é•¿æœŸé‡è¦æ€§ (0-1):
      1. 'é¡¹ç›®ä½¿ç”¨ Python 3.11' â†’ ?
      2. 'æ‰§è¡Œäº† pip install requests' â†’ ?
      3. 'ç”¨æˆ·è¯´ä»¥åæ‰€æœ‰ Python é¡¹ç›®éƒ½ç”¨ Poetry' â†’ ?"
    è¾“å‡º: [0.6, 0.1, 0.9]

  æ–¹å¼ B â€” è§„åˆ™åŠ æˆ:
    ç”¨æˆ·åå¥½è¯­ä¹‰ â†’ +0.3
    "æ€»æ˜¯/æ°¸è¿œ/æ¯æ¬¡" â†’ +0.2
    ä¸€æ¬¡æ€§ä¿¡æ¯ â†’ -0.3
    å¯†ç /å¯†é’¥ â†’ ä¸å­˜å‚¨ (importance = 0)
    type ä¸º user_preference â†’ æœ€ä½ 0.5

åŠ¨æ€è°ƒæ•´ (ä½¿ç”¨æ—¶):
  è¢«æ£€ç´¢ä¸”å®é™…ä½¿ç”¨ â†’ importance += 0.05
  è¢«æ£€ç´¢ä½†æœªä½¿ç”¨ â†’ importance -= 0.02
```

**é—å¿˜æœºåˆ¶ï¼š**

```
é—å¿˜è¯„åˆ†å…¬å¼:

  $$forgetScore = \frac{(1 - importance) \times daysSinceLastAccess}{accessCount + 1}$$

  ç¤ºä¾‹:
    è®°å¿† A: importance=0.3, 30å¤©æ²¡ç”¨, ç”¨è¿‡2æ¬¡
      â†’ forgetScore = (0.7 Ã— 30) / 3 = 7.0  (é«˜ï¼Œåº”è¯¥é—å¿˜)

    è®°å¿† B: importance=0.9, 60å¤©æ²¡ç”¨, ç”¨è¿‡10æ¬¡
      â†’ forgetScore = (0.1 Ã— 60) / 11 = 0.55 (ä½ï¼Œä¿ç•™)

é—å¿˜æµç¨‹:
  è§¦å‘: æ€»æ¡ç›® > 10000 æˆ– æ¯å‘¨å®šæœŸ
  1. è®¡ç®—æ‰€æœ‰è®°å¿†çš„ forgetScore
  2. forgetScore > threshold (é»˜è®¤ 10.0) â†’ å€™é€‰é—å¿˜
  3. ä¿æŠ¤è§„åˆ™:
     â†’ user_preference ä¸” importance > 0.5 â†’ è·³è¿‡
  4. å€™é€‰è®°å¿† â†’ ç§»å…¥ archive è¡¨
  5. å½’æ¡£ä¿ç•™ 30 å¤©ï¼Œä¹‹åçœŸæ­£åˆ é™¤
  6. 30 å¤©å†…è¢«æ£€ç´¢åˆ° â†’ æ¢å¤åˆ°ä¸»è¡¨
```

**è®°å¿†åˆå¹¶ï¼š**

```
è§¦å‘: å†™å…¥æ–°è®°å¿†æ—¶æ£€æŸ¥æ˜¯å¦ä¸å·²æœ‰è®°å¿†é‡å¤

æ£€æµ‹æ–¹å¼:
  Phase 1: å…³é”®è¯é‡å åº¦
    æ–°: "ç”¨æˆ·åå¥½ pnpmï¼Œä¸å–œæ¬¢ yarn"
    æ—§: "ç”¨æˆ·å–œæ¬¢ç”¨ pnpm"
    â†’ å…³é”®è¯é‡å é«˜ â†’ å€™é€‰åˆå¹¶

  Phase 2 (æœªæ¥): å‘é‡ç›¸ä¼¼åº¦
    â†’ embedding è·ç¦» < é˜ˆå€¼ â†’ å€™é€‰åˆå¹¶

åˆå¹¶æ“ä½œ:
  è°ƒç”¨ LLM:
    Prompt: "åˆå¹¶ä»¥ä¸‹ä¸¤æ¡ç›¸ä¼¼è®°å¿†ä¸ºä¸€æ¡æ›´å®Œæ•´çš„:
      A: 'ç”¨æˆ·å–œæ¬¢ç”¨ pnpm'
      B: 'ç”¨æˆ·åå¥½ pnpmï¼Œä¸å–œæ¬¢ yarn'"
    è¾“å‡º: "ç”¨æˆ·åå¥½ä½¿ç”¨ pnpm ç®¡ç† Node.js ä¾èµ–ï¼Œä¸å–œæ¬¢ yarn"

  å…ƒæ•°æ®åˆå¹¶:
    importance: max(A, B)
    accessCount: A + B
    createdAt: min(A, B)
    lastAccessedAt: max(A, B)
```

#### 5.3.5 è®°å¿†åœ¨å¤š Agent é—´çš„æµè½¬

```
è¯»å†™æƒé™:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Agent       â”‚ é•¿æœŸè®°å¿† è¯»    â”‚ é•¿æœŸè®°å¿† å†™    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Commander   â”‚ âœ“             â”‚ âœ“             â”‚
  â”‚ Lead        â”‚ âœ“             â”‚ âœ“             â”‚
  â”‚ Worker      â”‚ âœ“ (åªè¯»)      â”‚ âœ— (é€šè¿‡Lead)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Worker ä¸èƒ½ç›´æ¥å†™å…¥çš„åŸå› :
    æ•°é‡å¤šã€ç”Ÿå‘½å‘¨æœŸçŸ­ â†’ å¤§é‡ä½è´¨é‡å†™å…¥æ±¡æŸ“è®°å¿†åº“
    Worker å‘ç°æœ‰ä»·å€¼ä¿¡æ¯ â†’ ä¸ŠæŠ¥ Lead â†’ Lead å®¡æŸ¥åå†™å…¥

å†™å…¥æ—¶æœº:
  æ‰§è¡Œä¸­: Lead å‘ç°é‡è¦ä¿¡æ¯ â†’ å³æ—¶å†™å…¥
  ç»“æŸæ—¶: Lead åšä¸€æ¬¡"è®°å¿†æå–" (è°ƒç”¨ LLM ä»è¿‡ç¨‹ä¸­æå–)
  å…¨ä»»åŠ¡ç»“æŸ: Commander æå–å…¨å±€æ€§ç»éªŒ
    ä¾‹: "è¿™ç±»ä»»åŠ¡ç”¨ research_team æ¨¡å¼æ¯” tech_team æ›´åˆé€‚"

è¯»å–æ—¶æœº:
  ä»»åŠ¡å¼€å§‹: Commander æ£€ç´¢ç›¸å…³è®°å¿† (æœ€å¤š 10 æ¡)
  Lead å¯åŠ¨: æ£€ç´¢æœ¬é¢†åŸŸè®°å¿† (æœ€å¤š 5 æ¡)
  Worker å¯åŠ¨: Lead é€šè¿‡ä»»åŠ¡æè¿°ä¼ é€’å…³é”®è®°å¿† (æœ€å¤š 3 æ¡)

å®¹å™¨é‡å»º:
  é•¿æœŸè®°å¿†åœ¨ Volume ä¸­ï¼Œä¸ä¸¢å¤±
  çŸ­æœŸ/å·¥ä½œè®°å¿†ä¸¢å¤±
  ä¼šè¯å¿«ç…§å¯ç”¨äºæ¢å¤ä¸­æ–­çš„ä»»åŠ¡
```

### 5.4 å®‰å…¨æ¨¡å‹ï¼ˆå®¹å™¨å†…ç®€åŒ–ç‰ˆï¼‰

```
å› ä¸ºæ•´ä¸ªç¯å¢ƒåœ¨å®¹å™¨ä¸­ï¼Œå®‰å…¨ç­–ç•¥å¤§å¹…ç®€åŒ–:

Layer 1: åŸºæœ¬å‘½ä»¤è¿‡æ»¤ (ä¿ç•™)
  â†’ æ‹¦æˆª fork bombã€rm -rf / ç­‰æ˜æ˜¾æ¶æ„æ“ä½œ
  â†’ å°ºåº¦æ”¾å®½ï¼Œå› ä¸ºåäº†å°±é‡å»º

Layer 2: ç”¨æˆ·ç¡®è®¤ (ä¿ç•™ä½†æ”¾å®½)
  â†’ ä¸å†ç¡®è®¤ sudo (å®¹å™¨å†… root æ— æ‰€è°“)
  â†’ ä»ç„¶ç¡®è®¤: rm å¤§é‡æ–‡ä»¶ã€git pushã€ç½‘ç»œå¤–å‘æ“ä½œ
  â†’ é‡ç‚¹: æ¶‰åŠ Volume ä¸­ç”¨æˆ·æ•°æ®çš„åˆ é™¤

Layer 3: å®¡è®¡æ—¥å¿— (ä¿ç•™)
  â†’ è®°å½•æ‰€æœ‰æ“ä½œï¼Œæ–¹ä¾¿äº‹åè¿½æº¯

å–æ¶ˆçš„éƒ¨åˆ†:
  â†’ è·¯å¾„æ²™ç®±: å®¹å™¨æœ¬èº«å°±æ˜¯æ²™ç®±
  â†’ èµ„æºé™åˆ¶: Docker çš„ resource limits å¤„ç†
  â†’ ææƒé˜²æŠ¤: å®¹å™¨å†… root å½±å“æœ‰é™

æ–°å¢å…³é”®ç¡®è®¤:
  â†’ ç½‘ç»œå¤–å‘æ“ä½œ (curl POSTã€git pushã€ssh) â†’ ç¡®è®¤
  â†’ åŸå› : å®¹å™¨åäº†èƒ½é‡å»ºï¼Œå‘å‡ºå»çš„æ•°æ®æ”¶ä¸å›æ¥

IM æ¸ é“é¢å¤–é™åˆ¶:
  â†’ é«˜å±æ“ä½œä»…é™ Web UI / SSH æ‰§è¡Œ
  â†’ IM æ¶ˆæ¯ä¸­çš„æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨è„±æ•
```

### 5.5 å¯¹å¤–æ¥å£

```
Sub-Interface: MemoryBackend (è®°å¿†å­˜å‚¨åç«¯ â€” å¯æ›¿æ¢)
  save(entry: MemoryEntry): Promise<void>
  recall(query: string, options: RecallOptions): MemoryEntry[]
  delete(id: string): void
  update(id: string, patch: Partial<MemoryEntry>): void
  count(): number
  listByType(type: string): MemoryEntry[]

  å†…ç½®: JsonFileBackend, SqliteBackend
  å¤–éƒ¨: PostgresBackend, RedisBackend, VectorDBBackend, S3Backend

Sub-Interface: CompressionStrategy (å‹ç¼©ç­–ç•¥ â€” å¯æ›¿æ¢)
  shouldCompress(history: Message[], budget: TokenBudget): boolean
  compress(history: Message[], options: CompressOptions): Message[]

  å†…ç½®: ThreeZoneStrategy, SlidingWindowStrategy, LLMSummaryStrategy
  å¤–éƒ¨: SemanticStrategy, TopicClusterStrategy, HybridStrategy

Sub-Interface: ImportanceScorer (é‡è¦æ€§è¯„åˆ† â€” å¯æ›¿æ¢)
  score(content: string, context: ScoringContext): number

  å†…ç½®: LLMScorer, RuleBasedScorer, HybridScorer
  å¤–éƒ¨: EmbeddingScorer, FrequencyScorer

Sub-Interface: ForgettingPolicy (é—å¿˜ç­–ç•¥ â€” å¯æ›¿æ¢)
  evaluate(entries: MemoryEntry[]): ForgettingDecision[]

  å†…ç½®: ScoreBasedPolicy
  å¤–éƒ¨: NeverForgetPolicy, AggressivePolicy, CategoryPolicy

Sub-Interface: SecurityPolicy (å®‰å…¨ç­–ç•¥ â€” å¯æ›¿æ¢/å¯å åŠ )
  evaluate(action: AgentAction): SecurityDecision  // "allow"|"deny"|"confirm"

  å†…ç½®: ContainerRelaxedPolicy, NetworkGuardPolicy
  å¤–éƒ¨: StrictPolicy, AuditOnlyPolicy, CustomApprovalPolicy

Sub-Interface: ContextHook (ä¸Šä¸‹æ–‡æ„å»ºé’©å­ â€” å¯å åŠ )
  beforeBuild(context: ContextDraft): ContextDraft
  afterBuild(context: ContextDraft): ContextDraft

  å¤–éƒ¨ç”¨é€”: æ³¨å…¥é¡¹ç›®çº¦æŸã€æ—¶é—´æ„ŸçŸ¥ã€å¤–éƒ¨çŸ¥è¯† (RAG)ã€è‡ªå®šä¹‰ Prompt ç‰‡æ®µ

Sub-Interface: AgentLifecycleHook (Agent ç”Ÿå‘½å‘¨æœŸé’©å­ â€” å¯å åŠ )
  onAgentCreated / onAgentDestroyed
  onLoopStart / onLoopEnd
  onToolCall / onToolResult
  onError

  å¤–éƒ¨ç”¨é€”: æ€§èƒ½ç›‘æ§ã€é€šçŸ¥ (Webhook/é‚®ä»¶)ã€æˆæœ¬ç»Ÿè®¡ã€è°ƒè¯•æ—¥å¿—
```

---

## å…­ã€Layer 4 â€” å¤§æ¨¡å‹æ¥å£å±‚

### 6.1 ç»Ÿä¸€æ¥å£

```typescript
interface LLMProvider {
  chat(request: ChatRequest): Promise<ChatResponse>;
  countTokens(messages: Message[]): number;
  getModelInfo(): ModelInfo;
}

interface ChatRequest {
  messages: Message[];
  tools?: ToolDefinition[];
  system?: string;
  temperature?: number;
  maxTokens?: number;
}

interface ChatResponse {
  text?: string;
  toolCalls?: ToolCall[];
  usage: { inputTokens: number; outputTokens: number };
  hasToolCalls(): boolean;
  hasText(): boolean;
  isComplete(): boolean;
}
```

### 6.2 å¤šæ¨¡å‹ç®¡ç†

```typescript
class LLMManager {
  private providers: Map<string, LLMProvider>;

  // æ™ºèƒ½è·¯ç”±ï¼šæ ¹æ® Agent çº§åˆ«å’Œä»»åŠ¡å¤æ‚åº¦é€‰æ‹©æ¨¡å‹
  route(context: RoutingContext): LLMProvider;

  // é™çº§ç­–ç•¥ï¼šä¸»æ¨¡å‹å¤±è´¥æ—¶åˆ‡æ¢å¤‡ç”¨
  async chatWithFallback(request: ChatRequest): Promise<ChatResponse>;
}
```

### 6.3 å¯¹å¤–æ¥å£

```
Interface: LLMProvider (å¤§æ¨¡å‹æä¾›å•† â€” å¯æ‰©å±•)
  å†…ç½®: ClaudeProvider, OpenAIProvider, OllamaProvider
  å¤–éƒ¨: GeminiProvider, DeepSeekProvider, AzureOpenAIProvider,
        LocalLlamaProvider, GroqProvider, ä»»ä½• OpenAI å…¼å®¹ API

Interface: RoutingStrategy (æ¨¡å‹è·¯ç”±ç­–ç•¥ â€” å¯æ›¿æ¢)
  selectProvider(context: RoutingContext): LLMProvider

  å†…ç½®: LevelBasedRouting (Commanderç”¨å¼º/Leadç”¨ä¸­/Workerç”¨å¼±)
        FallbackRouting (ä¸»æ¨¡å‹å¤±è´¥åˆ‡å¤‡ç”¨)
  å¤–éƒ¨: CostOptimizedRouting, LatencyOptimizedRouting, LoadBalancingRouting

Interface: LLMMiddleware (LLM è°ƒç”¨ä¸­é—´ä»¶ â€” å¯å åŠ )
  process(request: ChatRequest, next: NextFn): ChatResponse

  å¤–éƒ¨ç”¨é€”: ç¼“å­˜ã€é‡è¯•ã€æ—¥å¿—ã€æ•æ„Ÿå†…å®¹è¿‡æ»¤ã€è®¡è´¹ç»Ÿè®¡ã€é™é€Ÿ
```

### 6.4 é…ç½®

```yaml
# config/llm.yaml

providers:
  claude:
    api_key: "${ANTHROPIC_API_KEY}"
    default_model: "claude-sonnet-4-20250514"
    max_tokens: 8192

  openai:
    api_key: "${OPENAI_API_KEY}"
    default_model: "gpt-4o"
    max_tokens: 4096

  ollama:
    endpoint: "http://localhost:11434"
    default_model: "qwen2.5:14b"

routing:
  default: "claude"
  fallback_order: ["claude", "openai", "ollama"]

token_budget:
  max_context_tokens: 32000
  compression_threshold: 24000
  reserve_for_response: 4096
```

---

## ä¸ƒã€Layer 5 â€” å¤š Agent å±‚çº§åä½œ

### 7.1 ä¸‰å±‚æ ‘çŠ¶ç»“æ„

```
ç»“æ„å›ºå®šï¼Œè§’è‰²ä¸å›ºå®š:

                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   Commander    â”‚
                     â”‚   (æŒ‡æŒ¥å®˜)      â”‚
                     â”‚   Level 1      â”‚
                     â”‚   æœ€å¤š 1 ä¸ª     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â”‚  Team Lead  â”‚  â”‚ Team Lead  â”‚  â”‚ Team Lead  â”‚  ... æœ€å¤š 7 ä¸ª
     â”‚  Level 2    â”‚  â”‚ Level 2    â”‚  â”‚ Level 2    â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚                â”‚
      â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
      â–¼     â–¼     â–¼   â–¼    â–¼    â–¼     â–¼    â–¼    â–¼
    Worker Worker Worker                               ... æ¯ç»„æœ€å¤š 7 ä¸ª
    Level 3

ä¸‰å±‚è§’è‰²çš„é€šç”¨å®šä¹‰:
  Commander: æ¥æ”¶ä»»åŠ¡ã€æˆ˜ç•¥æ‹†åˆ†ã€åˆ†é… Leadã€æœ€ç»ˆæ±‡æ€»
  Lead:      ç»†åŒ–ä»»åŠ¡ã€åˆ†é… Workerã€è´¨é‡å®¡æŸ¥ã€å‘ä¸Šæ±‡æŠ¥
  Worker:    å…·ä½“æ‰§è¡Œã€è°ƒç”¨å·¥å…·ã€ç»“æœä¸ŠæŠ¥
```

### 7.2 ä¸‰çº§è§’è‰²è¯¦ç»†å®šä¹‰

```
Level 1 â€” Commander (æŒ‡æŒ¥å®˜)
  æ•°é‡: 1 ä¸ª (å”¯ä¸€)
  ç›´æ¥æ±‡æŠ¥äºº: ç”¨æˆ·
  ä¸‹å±: æœ€å¤š 7 ä¸ª Lead
  æ ¸å¿ƒèŒè´£:
    1. ç†è§£ç”¨æˆ·æ„å›¾ï¼Œé€‰æ‹©ç»„ç»‡æ¨¡å¼
    2. åˆ¤æ–­ä»»åŠ¡è§„æ¨¡ (è‡ªå·±åš / åˆ†é… Lead / å®Œæ•´ä¸‰å±‚)
    3. å°†ä»»åŠ¡æ‹†åˆ†ä¸ºæ¨¡å—çº§å­ä»»åŠ¡ï¼Œåˆ†é…ç»™ Lead
    4. åˆ¶å®šè·¨ç»„çº¦å®š (æ¥å£è§„èŒƒã€æ–‡ä»¶èŒƒå›´)
    5. æ”¶é›† Lead æ±‡æŠ¥ï¼Œåšè·¨æ¨¡å—æ•´åˆæ£€æŸ¥
    6. å¤„ç† Lead å‡çº§çš„è·¨å›¢é˜Ÿå†²çª
    7. å‘ç”¨æˆ·æ±‡æŠ¥æœ€ç»ˆç»“æœ
  ä½¿ç”¨ LLM: æœ€å¼ºæ¨¡å‹ (Claude Opus / GPT-4o)
  å·¥å…·è°ƒç”¨æƒ: æœ‰ï¼Œä½†å°½é‡å§”æ´¾ç»™ä¸‹å±

Level 2 â€” Team Lead (ç»„é•¿)
  æ•°é‡: æŒ‰éœ€åˆ›å»ºï¼Œæœ€å¤š 7 ä¸ªåŒæ—¶å­˜åœ¨
  ç›´æ¥æ±‡æŠ¥äºº: Commander
  ä¸‹å±: æœ€å¤š 7 ä¸ª Worker
  æ ¸å¿ƒèŒè´£:
    1. æ¥æ”¶ Commander åˆ†é…çš„æ¨¡å—ä»»åŠ¡
    2. å°†æ¨¡å—ä»»åŠ¡æ‹†åˆ†ä¸ºå…·ä½“æ‰§è¡Œæ­¥éª¤
    3. åˆ¤æ–­æ˜¯å¦éœ€è¦ Worker (ç®€å•æ­¥éª¤è‡ªå·±åš)
    4. åˆ†é…æ­¥éª¤ç»™ Workerï¼Œç›‘æ§è¿›åº¦
    5. å®¡æŸ¥ Worker äº§å‡ºè´¨é‡
    6. æ•´åˆæœ¬æ¨¡å—ç»“æœï¼Œå‘ Commander æ±‡æŠ¥
  ä½¿ç”¨ LLM: ä¸­ç­‰æ¨¡å‹ (Claude Sonnet / GPT-4o-mini)
  é—²ç½®è¶…æ—¶: 5 åˆ†é’Ÿåé”€æ¯

Level 3 â€” Worker (æ‰§è¡Œè€…)
  æ•°é‡: æŒ‰éœ€åˆ›å»ºï¼Œæ¯ä¸ª Lead ä¸‹æœ€å¤š 7 ä¸ª
  ç›´æ¥æ±‡æŠ¥äºº: æ‰€å± Lead
  æ ¸å¿ƒèŒè´£:
    1. æ¥æ”¶ Lead åˆ†é…çš„å…·ä½“æ‰§è¡Œä»»åŠ¡
    2. ç›´æ¥è°ƒç”¨å·¥å…·å®Œæˆä»»åŠ¡ (çœŸæ­£å¹²æ´»çš„)
    3. é‡åˆ°é—®é¢˜å‘ Lead æ±‡æŠ¥
    4. å®Œæˆåå°†ç»“æœæ±‡æŠ¥ç»™ Lead
  ç‰¹ç‚¹: ä¸åšå†³ç­–åªæ‰§è¡Œã€ä¸Šä¸‹æ–‡çª—å£æœ€å°ã€å¯å¤§é‡å¹¶è¡Œ
  ä½¿ç”¨ LLM: è½»é‡æ¨¡å‹ (Claude Haiku / Ollama æœ¬åœ°)
  å®Œæˆä»»åŠ¡åç«‹å³é”€æ¯
```

### 7.3 æ¨¡å¼ç³»ç»Ÿ

Commander ä¸å›ºå®šä¸ºæŸç§è§’è‰²ï¼Œè€Œæ˜¯æ ¹æ®ç”¨æˆ·ä»»åŠ¡çš„æ€§è´¨**åŠ¨æ€é€‰æ‹©ç»„ç»‡æ¨¡å¼**ã€‚

#### 7.3.1 æ¨¡å¼é€‰æ‹©é€»è¾‘

```
ç”¨æˆ·è¾“å…¥ä»»åŠ¡
    â”‚
    â–¼
Commander (æœªç»‘å®šè§’è‰²) è°ƒç”¨ LLM åˆ†æ:
    â”‚
    â”œâ”€ å•ä¸€æ¨¡å¼:
    â”‚    ä¾‹: "åˆ›å»ºä¸€ä¸ª API æœåŠ¡" â†’ tech_team
    â”‚
    â”œâ”€ æ··åˆæ¨¡å¼:
    â”‚    ä¾‹: "åˆ›å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿå¹¶å†™å¥½å®Œæ•´æ–‡æ¡£"
    â”‚    â†’ tech_team (å¼€å‘) + creative_team (æ–‡æ¡£)
    â”‚    Commander ä»ä¸¤ä¸ªæ¨¡å¼ä¸­å„é€‰ Lead
    â”‚
    â””â”€ ä¸éœ€è¦æ¨¡å¼ (æç®€ä»»åŠ¡):
         ä¾‹: "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"
         â†’ Commander è‡ªå·±ç›´æ¥åš
```

#### 7.3.2 å†…ç½®æ¨¡å¼ä¸€è§ˆ

```
æ¨¡å¼ 1: tech_team (æŠ€æœ¯å›¢é˜Ÿ)
  é€‚ç”¨: è½¯ä»¶å¼€å‘ã€ç³»ç»Ÿè¿ç»´ã€æŠ€æœ¯é—®é¢˜
  Commander = æŠ€æœ¯æ€»ç›‘
  Lead ç±»å‹: frontend, backend, devops, testing,
             database, security, architecture

æ¨¡å¼ 2: research_team (ç ”ç©¶å›¢é˜Ÿ)
  é€‚ç”¨: ä¿¡æ¯æœé›†ã€åˆ†ææŠ¥å‘Šã€çŸ¥è¯†æ•´ç†
  Commander = ç ”ç©¶ä¸»ä»»
  Lead ç±»å‹: literature, data_analysis, experiment,
             writing, fact_check

æ¨¡å¼ 3: project_management (é¡¹ç›®ç®¡ç†)
  é€‚ç”¨: å¤šé˜¶æ®µé¡¹ç›®ã€æµç¨‹è§„åˆ’ã€è¿›åº¦è·Ÿè¸ª
  Commander = é¡¹ç›®ç»ç†
  Lead ç±»å‹: planning, execution, quality,
             communication, risk

æ¨¡å¼ 4: creative_team (åˆ›æ„å›¢é˜Ÿ)
  é€‚ç”¨: å†…å®¹åˆ›ä½œã€è®¾è®¡ã€æ–‡æ¡ˆ
  Commander = åˆ›æ„æ€»ç›‘
  Lead ç±»å‹: content, copywriting, design,
             review, localization

æ¨¡å¼ 5: ops_team (è¿ç»´å›¢é˜Ÿ)
  é€‚ç”¨: ç³»ç»Ÿç®¡ç†ã€ç›‘æ§å‘Šè­¦ã€æ•…éšœå¤„ç†
  Commander = è¿ç»´ä¸»ç®¡
  Lead ç±»å‹: monitoring, incident, deployment,
             backup, performance

æ¨¡å¼ 6: education_team (æ•™å­¦å›¢é˜Ÿ)
  é€‚ç”¨: å­¦ä¹ è¾…å¯¼ã€è¯¾ç¨‹è®¾è®¡ã€çŸ¥è¯†è®²è§£
  Commander = æ•™å­¦ä¸»ä»»
  Lead ç±»å‹: curriculum, tutoring, assessment, material

æ¨¡å¼ 7: data_team (æ•°æ®å›¢é˜Ÿ)
  é€‚ç”¨: æ•°æ®å¤„ç†ã€åˆ†æå»ºæ¨¡ã€å¯è§†åŒ–
  Commander = æ•°æ®æ€»ç›‘
  Lead ç±»å‹: ingestion, cleaning, analysis,
             visualization, pipeline
```

#### 7.3.3 è‡ªå®šä¹‰æ¨¡å¼

```yaml
# config/modes/custom/game-dev-team.yaml
# æˆ–é€šè¿‡æ’ä»¶æ³¨å†Œ

mode_id: game_dev_team
name: "æ¸¸æˆå¼€å‘å›¢é˜Ÿ"
description: "é€‚ç”¨äºæ¸¸æˆå¼€å‘ç›¸å…³çš„ä»»åŠ¡"

match_keywords:
  - "æ¸¸æˆ", "game", "å…³å¡", "è§’è‰²", "Unity", "Godot"

commander_prompt: |
  ä½ æ˜¯æ¸¸æˆé¡¹ç›®åˆ¶ä½œäººã€‚è´Ÿè´£åˆ†è§£æ¸¸æˆå¼€å‘ä»»åŠ¡ï¼Œ
  åè°ƒç¾æœ¯ã€ç¨‹åºã€ç­–åˆ’å„ç»„çš„é…åˆã€‚

lead_types:
  gameplay:
    name: "ç©æ³•è®¾è®¡ç»„é•¿"
    prompt: "ä½ æ˜¯ç©æ³•è®¾è®¡ç»„é•¿..."
    specialties: ["game design", "level design"]
  game_programming:
    name: "æ¸¸æˆç¼–ç¨‹ç»„é•¿"
    prompt: "ä½ æ˜¯æ¸¸æˆç¼–ç¨‹ç»„é•¿..."
    specialties: ["game engine", "physics"]
  art_direction:
    name: "ç¾æœ¯æŒ‡å¯¼ç»„é•¿"
    prompt: "ä½ æ˜¯ç¾æœ¯æŒ‡å¯¼ç»„é•¿..."
    specialties: ["UI/UX", "asset pipeline"]
  qa:
    name: "æµ‹è¯•ç»„é•¿"
    prompt: "ä½ æ˜¯QAç»„é•¿..."
    specialties: ["testing", "bug tracking"]
```

### 7.4 æ€»-åˆ†-æ€»-åˆ† æ‰§è¡Œæµç¨‹

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

é˜¶æ®µ 0: æ¨¡å¼é€‰æ‹©
  Commander åˆ†æä»»åŠ¡ â†’ é€‰æ‹©æ¨¡å¼ (æˆ–æ··åˆæ¨¡å¼) â†’ åŠ è½½è§’è‰²å®šä¹‰

é˜¶æ®µ 1: ç¬¬ä¸€ä¸ª"æ€»" â€” Commander æˆ˜ç•¥åˆ†è§£
  åˆ†æéœ€è¦å“ªäº› Lead â†’ å®šä¹‰ä¾èµ–å…³ç³» (DAG) â†’ åˆ¶å®šè·¨ç»„çº¦å®š
  äº§å‡º: ä»»åŠ¡åˆ†è§£å• + è·¨ç»„æ¥å£çº¦å®š

é˜¶æ®µ 2: ç¬¬ä¸€ä¸ª"åˆ†" â€” Lead ç»†åŒ–å¹¶åˆ†ç»™ Worker
  æ¯ä¸ª Lead æ”¶åˆ°æ¨¡å—ä»»åŠ¡ â†’ æ‹†åˆ†ä¸ºå…·ä½“æ­¥éª¤
  â†’ åˆ¤æ–­éœ€è¦å‡ ä¸ª Worker â†’ åˆ†é… (æˆ–ç®€å•æ­¥éª¤è‡ªå·±åš)

é˜¶æ®µ 3: Worker æ‰§è¡Œ
  è°ƒç”¨ MCP Tools â†’ æ“ä½œå®¹å™¨å†…æ–‡ä»¶/ç»ˆç«¯ â†’ ç»“æœä¸ŠæŠ¥ Lead

é˜¶æ®µ 4: ç¬¬äºŒä¸ª"æ€»" â€” Lead å®¡æŸ¥æ±‡æ€»
  æ”¶é›† Worker ç»“æœ â†’ è´¨é‡å®¡æŸ¥ â†’ å‘ç°é—®é¢˜æ‰“å›ä¿®æ”¹ (å°å¾ªç¯)
  â†’ å…¨éƒ¨é€šè¿‡ â†’ å‘ Commander æ±‡æŠ¥

é˜¶æ®µ 5: ç¬¬äºŒä¸ª"åˆ†" â€” Commander é›†æˆæ£€æŸ¥
  æ”¶åˆ°æ‰€æœ‰ Lead æ±‡æŠ¥ â†’ è·¨æ¨¡å—é›†æˆéªŒè¯
  â†’ å‘ç°é—®é¢˜ â†’ æ–°ä¸€è½®"åˆ†": æŒ‡æ´¾ Lead ä¿®æ”¹
  â†’ å…¨éƒ¨é€šè¿‡ â†’ æœ€ç»ˆæ±‡æ€»

é˜¶æ®µ 6: æœ€ç»ˆ"æ€»" â€” Commander å‘ç”¨æˆ·æ±‡æŠ¥
  å®Œæ•´ç»“æœæŠ¥å‘Š â†’ ç­‰å¾…ç”¨æˆ·åé¦ˆ
  â†’ ç”¨æˆ·æ»¡æ„ â†’ å®Œæˆ
  â†’ ç”¨æˆ·è¦è°ƒæ•´ â†’ æ–°ä¸€è½®"æ€»-åˆ†"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 7.5 å±‚çº§åŠ¨æ€ä¼¸ç¼©

```
Commander çš„ä¼¸ç¼©åˆ¤æ–­:

  æç®€ä»»åŠ¡ â†’ Commander è‡ªå·±åš (é›¶å±‚ä¸‹å±)
    "å‡ ç‚¹äº†ï¼Ÿ" "å½“å‰ç›®å½•æœ‰ä»€ä¹ˆï¼Ÿ"

  ç®€å•ä»»åŠ¡ â†’ Commander + 1 Lead (Lead ç›´æ¥æ‰§è¡Œ)
    "åˆå§‹åŒ–ä¸€ä¸ª Node é¡¹ç›®"

  ä¸­ç­‰ä»»åŠ¡ â†’ Commander + Lead + å°‘é‡ Worker
    "é‡æ„æ•°æ®åº“å±‚"

  å¤æ‚ä»»åŠ¡ â†’ å®Œæ•´ä¸‰å±‚
    "åˆ›å»ºå…¨æ ˆåº”ç”¨ + æ–‡æ¡£ + éƒ¨ç½²"
```

### 7.6 é€šä¿¡åè®®

```
ä¸¥æ ¼é€çº§é€šä¿¡ï¼Œä¸è·¨çº§:

  Commander â†â†’ Lead:   é€šè¿‡ TaskMessage
  Lead â†â†’ Worker:      é€šè¿‡ TaskMessage
  Worker â†â†’ MCP:       é€šè¿‡ MCP åè®®

  è·¨çº§éœ€æ±‚ (Worker æœ‰é—®é¢˜éœ€è¦ Commander å†³ç­–):
    Worker â†’ Lead â†’ Commander â†’ å¦ä¸€ä¸ª Lead
    é€çº§ä¼ é€’

ä¸‹è¡Œæ¶ˆæ¯ (ä¸Šçº§ â†’ ä¸‹çº§):
  {
    type: "task_assignment",
    payload: {
      taskId, description, constraints,
      dependencies,           // å‰ç½®ä»»åŠ¡
      predecessorResults,     // å‰ç½®ç»“æœæ‘˜è¦
      fileScope,              // æ–‡ä»¶èŒƒå›´é™åˆ¶
    }
  }

ä¸Šè¡Œæ¶ˆæ¯ (ä¸‹çº§ â†’ ä¸Šçº§):
  {
    type: "task_report",
    payload: {
      taskId, status,         // completed|failed|blocked|in_progress
      result, artifacts,      // äº§å‡ºçš„æ–‡ä»¶è·¯å¾„
      issues,
    }
  }

ç‰¹æ®Šæ¶ˆæ¯:
  { type: "escalation", payload: { problem, suggestion } }
```

### 7.7 é”™è¯¯å¤„ç†ï¼ˆä¸‰çº§ï¼‰

```
Level 3 â€” Worker:
  å‘½ä»¤æ‰§è¡Œå¤±è´¥ â†’ è‡ªå·±é‡è¯• (æœ€å¤š 3 æ¬¡)
  å°è¯•æ›¿ä»£æ–¹æ¡ˆ â†’ ä»ç„¶å¤±è´¥ â†’ ä¸ŠæŠ¥ Lead

Level 2 â€” Lead:
  Worker ä¸ŠæŠ¥å¤±è´¥ â†’ åˆ†æåŸå› 
  â†’ ç»™ Worker æ–°æŒ‡ä»¤é‡è¯•
  â†’ æ¢ä¸€ä¸ª Worker é‡åš
  â†’ è‡ªå·±äº²è‡ªæ¥
  â†’ å‘ Commander ä¸ŠæŠ¥ (è·¨æ¨¡å—é—®é¢˜)

Level 1 â€” Commander:
  Lead ä¸ŠæŠ¥å¤±è´¥ â†’ è¯„ä¼°å…¨å±€å½±å“
  â†’ è°ƒæ•´æ–¹æ¡ˆ (æ¢æŠ€æœ¯è·¯çº¿)
  â†’ é‡æ–°åˆ†è§£ä»»åŠ¡
  â†’ åˆ›å»ºæ–° Lead è¾…åŠ©
  â†’ å‘ç”¨æˆ·æŠ¥å‘Šï¼Œè¯·æ±‚æŒ‡å¯¼
```

### 7.8 å…±äº«å·¥ä½œç©ºé—´

```
/workspace/
â”œâ”€â”€ project-name/
â”‚   â”œâ”€â”€ frontend/        # Frontend Lead çš„æ–‡ä»¶èŒƒå›´
â”‚   â”œâ”€â”€ backend/         # Backend Lead çš„æ–‡ä»¶èŒƒå›´
â”‚   â”œâ”€â”€ docs/            # Copywriting Lead çš„æ–‡ä»¶èŒƒå›´
â”‚   â””â”€â”€ infra/           # DevOps Lead çš„æ–‡ä»¶èŒƒå›´
â”‚
â””â”€â”€ .aico/               # AICO åè°ƒå…ƒæ•°æ®
    â”œâ”€â”€ task-plan.json   # Commander çš„ä»»åŠ¡åˆ†è§£è®¡åˆ’
    â”œâ”€â”€ interfaces/      # è·¨ç»„çº¦å®š (API è§„èŒƒç­‰)
    â””â”€â”€ reports/         # å„ Lead çš„æ±‡æŠ¥

å†²çªé¿å…:
  1. Commander åˆ†é…æ—¶æ˜ç¡®æ¯ä¸ª Lead çš„æ–‡ä»¶èŒƒå›´
  2. å…±äº«æ–‡ä»¶ç”± Commander æŒ‡å®šå”¯ä¸€è´Ÿè´£äºº
  3. æ¥å£çº¦å®šç”± Commander åœ¨åˆ†é…å‰åˆ›å»º
  4. Worker ç»§æ‰¿ Lead çš„æ–‡ä»¶èŒƒå›´é™åˆ¶
  5. æ‰€æœ‰ Agent åœ¨åŒä¸€è¿›ç¨‹ä¸­è¿è¡Œ (é€»è¾‘å®ä¾‹ï¼Œéç‹¬ç«‹è¿›ç¨‹)
```

### 7.9 Agent å®ä¾‹ç®¡ç†

```
ç”Ÿå‘½å‘¨æœŸ:
  Commander: åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œå§‹ç»ˆå­˜åœ¨
  Lead:      æŒ‰éœ€åˆ›å»ºï¼Œé—²ç½®è¶…æ—¶ (5min) åé”€æ¯
  Worker:    æŒ‰éœ€åˆ›å»ºï¼Œå®Œæˆä»»åŠ¡åç«‹å³é”€æ¯

èµ„æºä¸Šé™:
  åŒæ—¶å­˜åœ¨çš„ Agent æ€»æ•°: å¯é…ç½®ï¼Œé»˜è®¤ 50
    Commander: 1
    Lead: â‰¤ 7
    Worker: â‰¤ 7 Ã— 7 = 49 (ç†è®ºæœ€å¤§ï¼Œå®é™…è¿œå°‘äºæ­¤)
  åŒæ—¶æ´»è·ƒé€šå¸¸ â‰¤ 10~15

LLM åˆ†é…:
  Commander: æœ€å¼ºæ¨¡å‹ (è§„åˆ’+å®¡æŸ¥ï¼Œè°ƒç”¨æ¬¡æ•°å°‘)
  Lead:      ä¸­ç­‰æ¨¡å‹ (ç»†åŒ–+å®¡æŸ¥ï¼Œè°ƒç”¨æ¬¡æ•°ä¸­ç­‰)
  Worker:    è½»é‡æ¨¡å‹ (æ‰§è¡Œä¸ºä¸»ï¼Œè°ƒç”¨æ¬¡æ•°å¤š)

Token é¢„ç®—:
  æ€»é¢„ç®—çº¦ 20% â†’ Commander
  æ€»é¢„ç®—çº¦ 30% â†’ æ‰€æœ‰ Lead
  æ€»é¢„ç®—çº¦ 50% â†’ æ‰€æœ‰ Worker
```

### 7.10 å¯¹å¤–æ¥å£

```
Interface: ModeDefinition (ç»„ç»‡æ¨¡å¼å®šä¹‰ â€” å¯æ‰©å±•)
  id, name, description, matchPatterns
  commanderPrompt, leadTypes[], defaultWorkerPrompt, constraints

Interface: ModeRegistry (æ¨¡å¼æ³¨å†Œå’Œå‘ç°)
  register / unregister / get / listAll
  findByTask(taskDescription): ModeDefinition[]

Interface: DecompositionStrategy (ä»»åŠ¡åˆ†è§£ç­–ç•¥ â€” å¯æ›¿æ¢)
  decompose(task, mode, context): TaskPlan
  å†…ç½®: LLMDecomposition, TemplateDecomposition
  å¤–éƒ¨: HybridDecomposition, InteractiveDecomposition

Interface: SchedulingStrategy (è°ƒåº¦ç­–ç•¥ â€” å¯æ›¿æ¢)
  schedule(plan, resources): ExecutionSchedule
  å†…ç½®: DAGTopologicalSchedule
  å¤–éƒ¨: PrioritySchedule, ResourceAwareSchedule

Interface: QualityGate (è´¨é‡é—¨æ§ â€” å¯å åŠ )
  review(taskResult, originalTask): "pass"|"revise"|"reject"
  å¤–éƒ¨: ä»£ç é£æ ¼æ£€æŸ¥ã€æµ‹è¯•è¦†ç›–ç‡é—¨æ§ã€å®‰å…¨æ‰«æã€äººå·¥å®¡æŸ¥

Interface: CollaborationHook (åä½œæµç¨‹é’©å­ â€” å¯å åŠ )
  onTaskAssigned / onTaskCompleted / onEscalation
  onModeSelected / onAllComplete
  å¤–éƒ¨: è¿›åº¦é€šçŸ¥ã€å·¥ä½œé‡ç»Ÿè®¡ã€åä½œæ¨¡å¼ä¼˜åŒ–
```

---

## å…«ã€Layer 6 â€” æ¥å…¥å±‚

### 8.1 è®¾è®¡åŸåˆ™

```
æ¥å…¥æ–¹å¼ä¸æ ¸å¿ƒé€»è¾‘å®Œå…¨è§£è€¦:
  æ‰€æœ‰æ¥å…¥æ–¹å¼éƒ½è¿æ¥åˆ°åŒä¸€ä¸ª AICOCore
  å¢åŠ æ–°æ¥å…¥æ–¹å¼ä¸éœ€è¦ä¿®æ”¹ä»»ä½•æ ¸å¿ƒä»£ç 
  
æ¥å…¥å±‚æœ¬èº«ä¹Ÿæ˜¯æ¥å£åŒ–çš„:
  AccessProvider æ¥å£ï¼Œä»»ä½•äººå¯ä»¥å®ç°æ–°çš„æ¥å…¥æ–¹å¼
  å†…ç½®çš„ Web UI / SSH / IM ä¸ç¬¬ä¸‰æ–¹æ’ä»¶åœ°ä½å¹³ç­‰
  
å¤šä¸ªæ¥å…¥æ–¹å¼å¯ä»¥åŒæ—¶å·¥ä½œ:
  ç”¨æˆ·å¯ä»¥åŒæ—¶å¼€ç€ Web UI å’Œ SSH
  é€šè¿‡ SessionEventBus ä¿æŒçŠ¶æ€åŒæ­¥
```

### 8.2 æ ¸å¿ƒæ¥å£

```
Interface: AccessProvider (æ¥å…¥æ–¹å¼æä¾›è€… â€” å¯æ‰©å±•)
  id: string
  name: string
  start(core: AICOCore): Promise<void>
  stop(): Promise<void>
  getStatus(): AccessStatus

  å†…ç½®: WebUIProvider, SSHProvider, CLIProvider, IMGatewayProvider
  å¤–éƒ¨: TelegramBotProvider, SlackBotProvider, RESTAPIProvider,
        gRPCProvider, VoiceProvider, ...

Interface: AICOCore (å†…æ ¸å…¥å£ â€” æ‰€æœ‰æ¥å…¥å…±ç”¨)
  createSession(user: UserInfo): Session
  sendMessage(sessionId, message): AsyncIterable<ResponseChunk>
  cancelTask(sessionId): void
  getSessionState(sessionId): SessionState
  listSessions(): SessionInfo[]

  ResponseChunk:
    type: "text" | "tool_call" | "tool_result"
         | "agent_status" | "confirmation_request"
         | "error" | "complete"
    data: any

Interface: SessionEventBus (ä¼šè¯äº‹ä»¶æ€»çº¿ â€” å¤šç«¯åŒæ­¥)
  subscribe(sessionId, listener): void
  unsubscribe(sessionId, listener): void
  emit(sessionId, event): void
```

### 8.3 Web UI

```
æŠ€æœ¯: Node.js HTTP Server + WebSocket (åŒè¿›ç¨‹)
ç«¯å£: 3000 (å¯é…ç½®)

é¡µé¢ç»“æ„:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  AICO Web UI                                    [è®¾ç½®]    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  ä¾§è¾¹æ        â”‚           ä¸»å¯¹è¯åŒº                         â”‚
  â”‚              â”‚  æµå¼ AI å›å¤ + å·¥å…·è°ƒç”¨å±•ç¤º                 â”‚
  â”‚  ä¼šè¯åˆ—è¡¨     â”‚  ç¡®è®¤å¯¹è¯æ¡†                                â”‚
  â”‚  Agent æ ‘çŠ¶å›¾ â”‚  ä»£ç è¯­æ³•é«˜äº® + Markdown æ¸²æŸ“              â”‚
  â”‚  è®°å¿†æµè§ˆå™¨   â”‚                                           â”‚
  â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚              â”‚  [è¾“å…¥æ¡†] è¯·è¾“å…¥ä½ çš„æŒ‡ä»¤...       [å‘é€]    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  çŠ¶æ€æ : æ¨¡å¼ â”‚ æ´»è·ƒAgent â”‚ Tokenæ¶ˆè€—                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŠŸèƒ½æ¨¡å—:
  1. ä¸»å¯¹è¯åŒº â€” æµå¼ WebSocket æ¸²æŸ“
  2. Agent çŠ¶æ€é¢æ¿ â€” å®æ—¶æ˜¾ç¤º Agent æ ‘å’ŒçŠ¶æ€
  3. ä¼šè¯ç®¡ç† â€” å†å²/æ–°å»º/åˆ‡æ¢/æœç´¢
  4. è®°å¿†æµè§ˆå™¨ â€” æŸ¥çœ‹/æ·»åŠ /ç¼–è¾‘/åˆ é™¤/æœç´¢é•¿æœŸè®°å¿†
  5. è®¾ç½®é¡µé¢ â€” API Key/æ¨¡å‹/å®‰å…¨/æ¨¡å¼/æ’ä»¶/è®°å¿†é…ç½®
  6. å†…åµŒç»ˆç«¯ â€” xterm.jsï¼Œç›´æ¥åœ¨æµè§ˆå™¨æ“ä½œå®¹å™¨
  7. æ’ä»¶ç®¡ç† â€” å®‰è£…/å¸è½½/é…ç½®

æ•°æ®æµ:
  æµè§ˆå™¨ â†â”€WebSocketâ”€â†’ Web Server
                         â”‚
                         â–¼
                   AICOCore.sendMessage()
                         â”‚
                         â–¼
                   ResponseChunk æµ â†’ WebSocket æ¨é€ â†’ æµè§ˆå™¨æ¸²æŸ“
```

### 8.4 SSH ç»ˆç«¯

```
æŠ€æœ¯: ssh2 åº“ (Node.js åŸç”Ÿ SSH åè®®ï¼Œä¸ä¾èµ–ç³»ç»Ÿ sshd)
ç«¯å£: 2222 (å¯é…ç½®)

è¿æ¥: ssh aico@<host> -p 2222

è®¤è¯æ–¹å¼ (å¯é…ç½®):
  1. å¯†ç è®¤è¯ â€” é¦–æ¬¡å¯åŠ¨ç”Ÿæˆéšæœºå¯†ç æˆ–é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®
  2. å¯†é’¥è®¤è¯ â€” æŒ‚è½½å…¬é’¥æ–‡ä»¶
  3. æ— è®¤è¯ â€” ä»…é™æœ¬æœº/å†…ç½‘

è¿æ¥åä½“éªŒ:
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘             AICO â€” AI Computer Operator          â•‘
  â•‘  æ¨¡å¼: è‡ªåŠ¨é€‰æ‹© â”‚ æ¨¡å‹: Claude Sonnet            â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  > (è¾“å…¥è‡ªç„¶è¯­è¨€æˆ– /å‘½ä»¤)

ç‰¹æ®ŠåŠŸèƒ½:
  1. å¯¹è¯æ¨¡å¼ (é»˜è®¤) â€” ä¸ AI å¯¹è¯
  2. è£¸ç»ˆç«¯æ¨¡å¼ â€” /shell åˆ‡æ¢åˆ°å®¹å™¨ bash
  3. ç›´æ¥æ‰§è¡Œ â€” /exec ls -la (ä¸ç»è¿‡ AI)
  4. å¤šä¼šè¯ â€” å¤šä¸ª SSH è¿æ¥ï¼Œå¯åŠ å…¥åŒä¸€æˆ–ç‹¬ç«‹ä¼šè¯
  5. SFTP æ–‡ä»¶ä¼ è¾“ â€” sftp -P 2222 aico@host
     scp -P 2222 file.txt aico@host:/workspace/
```

### 8.5 IM å¹³å°å¯¹æ¥

#### 8.5.1 IM é€‚é…æ¶æ„

```
ä¸‰å±‚ç»“æ„:

  Layer A: å¹³å° SDK (æ¯ä¸ªå¹³å°ç‹¬æœ‰)
    Telegram Bot API / Slack Bolt / discord.js / é£ä¹¦ SDK / é’‰é’‰ SDK / ...

  Layer B: IMAdapter (é€šç”¨é€‚é…å±‚ï¼Œæ‰€æœ‰ IM å…±ç”¨)
    ç»Ÿä¸€æ¶ˆæ¯æ¨¡å‹ / æ¶ˆæ¯åˆ†ç‰‡ / ç¡®è®¤äº¤äº’ / é¢‘ç‡æ§åˆ¶
    æƒé™éªŒè¯ / æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ / ä¼šè¯ç®¡ç†

  Layer C: AICOCore (ä¸å…¶ä»–æ¥å…¥æ–¹å¼å®Œå…¨ç›¸åŒ)
```

#### 8.5.2 IMAdapter ç»Ÿä¸€æ¥å£

```
Interface: IMPlatformAdapter (æ¯ä¸ªå¹³å°å®ç°)
  connect / disconnect
  sendText / sendRichMessage / sendButtons
  updateMessage / sendFile
  onMessage / onButtonClick
  getPlatformCapabilities

  PlatformCapabilities:
    supportsButtons: boolean        # äº¤äº’æŒ‰é’®
    supportsRichText: boolean       # å¯Œæ–‡æœ¬
    supportsFileUpload: boolean     # æ–‡ä»¶å‘é€
    supportsMessageEdit: boolean    # ç¼–è¾‘å·²å‘æ¶ˆæ¯
    supportsThreads: boolean        # æ¶ˆæ¯çº¿ç¨‹
    maxMessageLength: number        # å•æ¡æ¶ˆæ¯ä¸Šé™
    maxFileSize: number             # æ–‡ä»¶å¤§å°é™åˆ¶
    markdownVariant: string         # Markdown å˜ä½“

Abstract Class: IMAdapter (é€šç”¨é€»è¾‘ï¼Œå­ç±»ç»§æ‰¿)
  handleIncoming     â†’ é€šç”¨æ¶ˆæ¯å¤„ç†æµç¨‹
  formatResponse     â†’ å“åº”æ ¼å¼åŒ–
  splitMessage       â†’ æ¶ˆæ¯åˆ†ç‰‡
  handleConfirmation â†’ ç¡®è®¤äº¤äº’
  manageSession      â†’ ä¼šè¯ç®¡ç† (æŒ‰ platformUserId éš”ç¦»)
  filterSensitive    â†’ æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

ç»Ÿä¸€æ¶ˆæ¯æ¨¡å‹:
  IncomingMessage:
    platformUserId, platformChatId, text
    attachments?, replyToMessageId?, platform, raw

  OutgoingMessage:
    text?, richContent? (RichMessage), buttons?, files?

  RichMessage:
    format: "markdown" | "html" | "plaintext" | "card"
    content, card?

  Button:
    id, label, style: "primary"|"danger"|"default", data?

Interface: IMGatewayProvider (IM ç½‘å…³ â€” AccessProvider å®ç°)
  registerAdapter / unregisterAdapter / listAdapters / getAdapterStatus

Interface: IMUserManager (IM ç”¨æˆ·æƒé™ç®¡ç†)
  authorize(platformUserId, platform): AuthResult
  getUserRole(): "admin" | "user" | "viewer"
  setUserRole()
  getSessionMapping(platformUserId): sessionId
```

#### 8.5.3 å„å¹³å°å¯¹æ¥è¦ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¹³å°      â”‚ æ¥å…¥æ–¹å¼      â”‚Markdownâ”‚ æŒ‰é’®   â”‚ç¼–è¾‘  â”‚çº¿ç¨‹  â”‚æ¶ˆæ¯é•¿åº¦    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Telegram  â”‚Bot API      â”‚ âœ“ V2   â”‚âœ“ Inlineâ”‚ âœ“    â”‚ âœ—    â”‚ 4096      â”‚
â”‚          â”‚Polling/Hook â”‚        â”‚Keyboardâ”‚      â”‚      â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Slack     â”‚Bolt SDK     â”‚âœ“ mrkdwnâ”‚âœ“ Block â”‚ âœ“    â”‚ âœ“    â”‚ 40000     â”‚
â”‚          â”‚Socket Mode  â”‚        â”‚Kit     â”‚      â”‚      â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Discord   â”‚discord.js   â”‚âœ“ æ ‡å‡†   â”‚âœ“ Comp  â”‚ âœ“    â”‚ âœ“    â”‚ 2000      â”‚
â”‚          â”‚Gateway WS   â”‚        â”‚onents  â”‚      â”‚      â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ä¼ä¸šå¾®ä¿¡   â”‚Bot Webhook  â”‚âœ“ æœ‰é™   â”‚âœ— æœ‰é™  â”‚ âœ—    â”‚ âœ—    â”‚ 2048      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚é£ä¹¦       â”‚SDK+Event    â”‚âœ— è‡ªæœ‰   â”‚âœ“ å¡ç‰‡  â”‚âœ“ å¡ç‰‡â”‚ âœ—    â”‚ å®½æ¾      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚é’‰é’‰       â”‚SDK+Stream   â”‚âœ“       â”‚âœ“ å¡ç‰‡  â”‚âœ“ å¡ç‰‡â”‚ âœ—    â”‚ 20000     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Matrix    â”‚matrix-js-sdkâ”‚âœ“       â”‚âœ—       â”‚ âœ“    â”‚ âœ“    â”‚ å®½æ¾      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 8.5.4 IM ç‰¹æœ‰äº¤äº’æ¨¡å¼å¤„ç†

```
æµå¼è¾“å‡ºæ›¿ä»£:
  ç­–ç•¥ A â€” ç¼–è¾‘æ¶ˆæ¯æ¨¡æ‹Ÿ (Slack/Discord/é£ä¹¦/é’‰é’‰):
    å…ˆå‘ "â³ æ­£åœ¨æ€è€ƒ..." â†’ é€æ­¥æ›´æ–°æ¶ˆæ¯å†…å®¹ â†’ æœ€ç»ˆç»“æœ
    é¢‘ç‡æ§åˆ¶: â‰¤ æ¯ 2 ç§’ä¸€æ¬¡

  ç­–ç•¥ B â€” åˆ†æ®µå‘é€ (Telegram/ä¼ä¸šå¾®ä¿¡):
    å…ˆå‘ "â³" â†’ æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µå‘ä¸€æ¡ â†’ æœ€ç»ˆç»“æœ

  ç­–ç•¥ C â€” ä»…å‘æœ€ç»ˆç»“æœ (æç®€):
    å‘ typing çŠ¶æ€ â†’ å…¨éƒ¨å®Œæˆåå‘ä¸€æ¡

ç¡®è®¤æ“ä½œ:
  ç­–ç•¥ A â€” äº¤äº’æŒ‰é’® (æ”¯æŒæŒ‰é’®çš„å¹³å°):
    âš ï¸ AI æƒ³è¦æ‰§è¡Œ: `git push origin main`
    [âœ… å…è®¸] [âŒ æ‹’ç»] [ğŸ”“ æ€»æ˜¯å…è®¸]

  ç­–ç•¥ B â€” æ–‡æœ¬å›å¤ (ä¸æ”¯æŒæŒ‰é’®çš„å¹³å°):
    è¯·å›å¤ Y å…è®¸ / N æ‹’ç»
    è¶…æ—¶ 60 ç§’è‡ªåŠ¨æ‹’ç»

é•¿æ¶ˆæ¯åˆ†ç‰‡:
  1. è¶…è¿‡ maxMessageLength â†’ æ™ºèƒ½æˆªæ–­ (ä»£ç å—/æ®µè½è¾¹ç•Œ)
  2. è¶…è¿‡ 3 ç‰‡ â†’ è½¬ä¸ºæ–‡ä»¶å‘é€
  3. é•¿ä»£ç  â†’ .txt/.log æ–‡ä»¶é™„ä»¶

å¤šç”¨æˆ·éš”ç¦»:
  æ¯ä¸ª platformUserId â†’ ç‹¬ç«‹ AICO Session
  ç¾¤èŠ: @æåŠ æ‰å“åº”ï¼Œå¯é…ç½®å…±äº«/ç‹¬ç«‹ä¼šè¯

å®‰å…¨:
  æ•æ„Ÿä¿¡æ¯è¿‡æ»¤: å¯†ç /token/å¯†é’¥ â†’ è‡ªåŠ¨è„±æ•å†å‘é€
  é«˜å±æ“ä½œé™åˆ¶: rm -rf ç­‰ä»…é™ Web UI / SSH
  ç”¨æˆ·æƒé™: admin/user/viewer ä¸‰çº§
```

### 8.6 ç»Ÿä¸€å‘½ä»¤ä½“ç³»

SSH å’Œ CLI å…±äº«åŒä¸€å¥—å‘½ä»¤è§£æå™¨ï¼ŒWeb UI é€šè¿‡ API è°ƒç”¨ç­‰æ•ˆåŠŸèƒ½ï¼š

```
å¯¹è¯å‘½ä»¤ (è‡ªç„¶è¯­è¨€ â†’ å‘ç»™ Commander):
  ä»»æ„ä¸ä»¥ / å¼€å¤´çš„æ–‡æœ¬

ç³»ç»Ÿå‘½ä»¤ (ä»¥ / å¼€å¤´):

  é€šç”¨:
    /help          å¸®åŠ©
    /version       ç‰ˆæœ¬
    /exit          é€€å‡º
    /cancel        ä¸­æ–­å½“å‰ä»»åŠ¡

  ä¼šè¯ç®¡ç†:
    /session list / new / join <id> / rename <name> / delete <id>

  Agent çŠ¶æ€:
    /status        æ€»è§ˆ
    /agents        æ´»è·ƒ Agent æ ‘
    /agents <id>   æŸ¥çœ‹æŸä¸ª Agent è¯¦æƒ…
    /mode          å½“å‰æ¨¡å¼
    /mode list     å¯ç”¨æ¨¡å¼åˆ—è¡¨
    /mode set <n>  è®¾ç½®é»˜è®¤æ¨¡å¼

  è®°å¿†ç®¡ç†:
    /memory list / search <q> / add <text> / edit <id> / delete <id>
    /memory stats / cleanup

  æ’ä»¶ç®¡ç†:
    /plugin list / install <pkg> / uninstall <id>
    /plugin enable <id> / disable <id> / info <id>

  é…ç½®:
    /config show / set <key> <val> / reset

  å®¹å™¨/ç»ˆç«¯:
    /shell         è¿›å…¥è£¸ç»ˆç«¯
    /exec <cmd>    ç›´æ¥æ‰§è¡Œå‘½ä»¤ (ä¸ç»è¿‡ AI)
    /health        å®¹å™¨å¥åº·çŠ¶æ€

Web UI ç­‰ä»·:
  æ¯ä¸ª / å‘½ä»¤å¯¹åº” REST API
  /memory list â†’ GET /api/memory â†’ è®°å¿†æµè§ˆå™¨ç•Œé¢
  /plugin install â†’ POST /api/plugins â†’ æ’ä»¶å®‰è£…å¼¹çª—
  /shell â†’ æ‰“å¼€å†…åµŒç»ˆç«¯é¢æ¿
```

### 8.7 å…¨éƒ¨æ¥å…¥æ–¹å¼å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚WebUI â”‚ SSH  â”‚ CLI  â”‚ Telegram â”‚ Slack â”‚Discordâ”‚ æ’ä»¶  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚æµå¼è¾“å‡º   â”‚ âœ“    â”‚ âœ“    â”‚ âœ“    â”‚ ç¼–è¾‘æ¨¡æ‹Ÿ  â”‚ç¼–è¾‘æ¨¡æ‹Ÿâ”‚ç¼–è¾‘æ¨¡æ‹Ÿâ”‚æŒ‰å¹³å° â”‚
â”‚Agentæ ‘    â”‚å›¾å½¢åŒ– â”‚æ–‡æœ¬   â”‚æ–‡æœ¬   â”‚ âœ—        â”‚å¡ç‰‡   â”‚Embed â”‚æŒ‰å¹³å° â”‚
â”‚ç¡®è®¤æ“ä½œ   â”‚å¼¹çª—   â”‚y/n   â”‚y/n   â”‚æŒ‰é’®      â”‚æŒ‰é’®   â”‚æŒ‰é’®  â”‚æŒ‰å¹³å° â”‚
â”‚æ–‡ä»¶ä¼ è¾“   â”‚ä¸Šä¼ ä¸‹è½½â”‚SFTP  â”‚ âœ—    â”‚å‘é€æ–‡ä»¶   â”‚å‘é€   â”‚å‘é€  â”‚æŒ‰å¹³å° â”‚
â”‚ç»ˆç«¯è®¿é—®   â”‚xterm â”‚/shellâ”‚å†…ç½®  â”‚ âœ—        â”‚ âœ—    â”‚ âœ—    â”‚ âœ—    â”‚
â”‚è®°å¿†ç®¡ç†   â”‚GUI   â”‚/memoryâ”‚/memoryâ”‚/memory  â”‚/memoryâ”‚/memoryâ”‚/memoryâ”‚
â”‚æ’ä»¶ç®¡ç†   â”‚GUI   â”‚/pluginâ”‚/pluginâ”‚âœ—(å®‰å…¨)  â”‚âœ—(å®‰å…¨)â”‚âœ—(å®‰å…¨)â”‚æŒ‰æƒ…å†µ â”‚
â”‚è®¾ç½®ä¿®æ”¹   â”‚GUI   â”‚/configâ”‚/configâ”‚âœ—(å®‰å…¨)  â”‚âœ—(å®‰å…¨)â”‚âœ—(å®‰å…¨)â”‚æŒ‰æƒ…å†µ â”‚
â”‚å¤šç”¨æˆ·    â”‚å¯é€‰   â”‚å¯é€‰   â”‚å•ç”¨æˆ· â”‚å¤©ç„¶å¤šç”¨æˆ·â”‚å¤©ç„¶   â”‚å¤©ç„¶  â”‚æŒ‰å¹³å° â”‚
â”‚å®‰å…¨çº§åˆ«   â”‚é«˜     â”‚é«˜    â”‚é«˜    â”‚ä¸­(è¿‡æ»¤)  â”‚ä¸­    â”‚ä¸­    â”‚ä¸­    â”‚
â”‚éƒ¨ç½²è¦æ±‚   â”‚ç«¯å£   â”‚ç«¯å£  â”‚attachâ”‚å¯ä¸éœ€ç«¯å£â”‚å¯ä¸éœ€ â”‚éœ€Bot â”‚æŒ‰å¹³å° â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€æ’ä»¶ç³»ç»Ÿ

### 9.1 ç»Ÿä¸€æœºåˆ¶

```
æ‰€æœ‰å±‚çš„æ‰©å±•éƒ½é€šè¿‡ç»Ÿä¸€çš„æ’ä»¶ç³»ç»Ÿç®¡ç†:

æ’ä»¶å‘ç°:
  1. /app/plugins/ ç›®å½• (Volume æŒä¹…åŒ–)
  2. config/plugins.yaml å£°æ˜çš„ npm åŒ…
  3. è¿è¡Œæ—¶ API åŠ¨æ€æ³¨å†Œ

æ’ä»¶ç»“æ„:
  my-plugin/
  â”œâ”€â”€ manifest.yaml    # æ’ä»¶å£°æ˜
  â”œâ”€â”€ index.ts         # å…¥å£
  â””â”€â”€ ...              # å…·ä½“å®ç°

manifest.yaml:
  id: "my-plugin"
  name: "My Plugin"
  version: "1.0.0"
  layer: 3                  # ä½œç”¨å±‚ (å¯å¤šå±‚)
  provides:
    - type: "memory_backend"
      id: "postgres-memory"
  requires:
    - "mcp-terminal"
  config_schema: ...

æ’ä»¶å…¥å£æ¥å£:
  interface AICOPlugin {
    activate(context: PluginContext): Promise<void>;
    deactivate(): Promise<void>;
  }

PluginContext æä¾›:
  â†’ æ³¨å†Œè¡¨è®¿é—® (æ³¨å†Œæ–°æ¨¡å¼/å·¥å…·/ç­–ç•¥/é’©å­)
  â†’ é…ç½®è®¿é—®
  â†’ æ—¥å¿—
  â†’ å…¶ä»–æ’ä»¶çš„å…¬å…± API

æ’ä»¶ç”Ÿå‘½å‘¨æœŸ:
  load â†’ validate â†’ configure â†’ activate â†’ deactivate
```

### 9.2 æ’ä»¶èƒ½åŠ›ä¸€è§ˆï¼ˆæŒ‰å±‚ï¼‰

```
Layer 1: è‡ªå®šä¹‰ç¯å¢ƒåˆå§‹åŒ–ã€å¥åº·ç›‘æ§å‘Šè­¦
Layer 2: æ–° MCP Server (mcp-database, mcp-kubernetes, mcp-aws ...)
Layer 3: æ›¿æ¢è®°å¿†åç«¯ã€å‹ç¼©ç­–ç•¥ã€è¯„åˆ†ç®—æ³•ã€é—å¿˜ç­–ç•¥ã€å®‰å…¨ç­–ç•¥ã€
         ä¸Šä¸‹æ–‡æ³¨å…¥ (RAG)ã€ç”Ÿå‘½å‘¨æœŸç›‘æ§
Layer 4: æ–° LLM Providerã€è·¯ç”±ç­–ç•¥ã€è°ƒç”¨ä¸­é—´ä»¶ (ç¼“å­˜/é‡è¯•/è®¡è´¹)
Layer 5: æ–°ç»„ç»‡æ¨¡å¼ã€åˆ†è§£ç­–ç•¥ã€è°ƒåº¦ç­–ç•¥ã€è´¨é‡é—¨æ§ã€åä½œé’©å­
Layer 6: æ–°æ¥å…¥æ–¹å¼ (IM Bot / REST API / gRPC / Voice ...)

è·¨å±‚æ’ä»¶ç¤ºä¾‹:
  "å…¨æ ˆå¼€å‘å¢å¼ºåŒ…":
    Layer 2: mcp-database, mcp-docker
    Layer 3: ä»£ç åˆ†æä¸Šä¸‹æ–‡é’©å­
    Layer 5: fullstack_team æ¨¡å¼
```

### 9.3 æ’ä»¶å®‰è£…æ–¹å¼

```
æ–¹å¼ 1: æ„å»ºæ—¶ (å†™å…¥ Dockerfile)
  é€‚åˆç¨³å®šé‡è¦çš„æ’ä»¶
  å®¹å™¨é‡å»ºåè‡ªåŠ¨å­˜åœ¨

æ–¹å¼ 2: è¿è¡Œæ—¶æŒ‚è½½ (Volume)
  æ”¾å…¥ /app/plugins/ ç›®å½•
  ä¸éœ€è¦é‡å»ºé•œåƒ

æ–¹å¼ 3: è¿è¡Œæ—¶å®‰è£… (å‘½ä»¤)
  aico plugin install <package>
  å®‰è£…åˆ° /app/plugins/ (Volume æŒä¹…åŒ–)
```

### 9.4 æ¥å£è¡Œä¸ºåˆ†ç±»

```
å¯æ›¿æ¢ (Replaceable):
  åŒæ—¶åªæœ‰ä¸€ä¸ªå®ç°ç”Ÿæ•ˆï¼Œåæ³¨å†Œè¦†ç›–å…ˆæ³¨å†Œ
  ä¾‹: MemoryBackend â€” è¦ä¹ˆ SQLiteï¼Œè¦ä¹ˆ PostgreSQL

å¯å åŠ  (Stackable):
  å¤šä¸ªå®ç°åŒæ—¶ç”Ÿæ•ˆï¼Œé“¾å¼æ‰§è¡Œ
  ä¾‹: SecurityPolicy â€” å‘½ä»¤è¿‡æ»¤ + ç½‘ç»œé˜²æŠ¤ + è‡ªå®šä¹‰è§„åˆ™
  ä¾‹: ContextHook â€” ä¾æ¬¡æ³¨å…¥ä¸åŒå†…å®¹
  ä¾‹: LLMMiddleware â€” ä¸­é—´ä»¶é“¾

å¯æ‰©å±• (Extensible):
  å¤šä¸ªå®ç°å¹¶å­˜ï¼ŒæŒ‰éœ€é€‰æ‹©
  ä¾‹: LLMProvider â€” Claude å’Œ OpenAI åŒæ—¶æ³¨å†Œï¼Œè·¯ç”±é€‰æ‹©
  ä¾‹: ModeDefinition â€” æ‰€æœ‰æ¨¡å¼å¹¶å­˜ï¼ŒCommander é€‰æ‹©
```

---

## åã€System Prompt è®¾è®¡

```
Commander çš„åŸºç¡€ System Prompt (æ¨¡å¼ç»‘å®šå‰):

"ä½ æ˜¯ AICO (AI Computer Operator) çš„æŒ‡æŒ¥å®˜ã€‚

## ä½ çš„èƒ½åŠ›
ä½ ç®¡ç†ä¸€ä¸ªå±‚çº§åŒ–çš„ Agent å›¢é˜Ÿ:
- ä½ å¯ä»¥å°†ä»»åŠ¡åˆ†é…ç»™æœ€å¤š 7 ä¸ª Team Lead
- æ¯ä¸ª Lead å¯ä»¥ç®¡ç†æœ€å¤š 7 ä¸ª Worker
- ç®€å•ä»»åŠ¡ä½ ä¹Ÿå¯ä»¥è‡ªå·±ç›´æ¥å®Œæˆ

## å¯ç”¨å·¥å…·
ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å·¥å…·ä¸ç”µè„‘äº¤äº’:
- execute_command: åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤
- run_script: è¿è¡Œè„šæœ¬ä»£ç 
- ç»ˆç«¯ä¼šè¯ç®¡ç†å·¥å…·

## æ“ä½œåŸåˆ™
1. å…ˆè§‚å¯Ÿåè¡ŒåŠ¨: æ‰§è¡Œç ´åæ€§æ“ä½œå‰å…ˆäº†è§£ç°çŠ¶
2. æœ€å°å½±å“: é€‰æ‹©å½±å“èŒƒå›´æœ€å°çš„æ–¹æ¡ˆ
3. åˆ†æ­¥æ‰§è¡Œ: å¤æ‚ä»»åŠ¡åˆ†æ­¥æ‰§è¡Œï¼Œæ¯æ­¥éªŒè¯
4. è§£é‡Šæ„å›¾: æ¯æ¡å‘½ä»¤å‰è¯´æ˜ç›®çš„
5. é”™è¯¯å¤„ç†: å¤±è´¥æ—¶åˆ†æåŸå› ï¼Œä¸ç›²ç›®é‡è¯•

## å½“å‰ç¯å¢ƒ
- è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œç¯å¢ƒæŸåå¯é‡å»º
- æ“ä½œç³»ç»Ÿ: {{os}}
- Shell: {{shell}}
- å·¥ä½œç›®å½•: {{cwd}}
- å·²å®‰è£…å·¥å…·: {{installedTools}}

## è®°å¿†
{{relevantMemories}}

## å®‰å…¨çº¦æŸ
- ä¸æ‰§è¡Œä¸ç¡®å®šåæœçš„å‘½ä»¤
- æ¶‰åŠç½‘ç»œå¤–å‘æ“ä½œå…ˆç¡®è®¤
- ä¸åœ¨å‘½ä»¤ä¸­åŒ…å«å¯†ç æˆ–æ•æ„Ÿä¿¡æ¯"

æ¨¡å¼ç»‘å®šåè¿½åŠ :
"## å½“å‰æ¨¡å¼: {{modeName}}
{{commanderPrompt}}

## å¯ç”¨ Lead ç±»å‹:
{{leadTypes}}

## ä»»åŠ¡åˆ†ææ­¥éª¤:
1. åˆ†æä»»åŠ¡æ¶‰åŠå“ªäº›é¢†åŸŸ
2. å†³å®šéœ€è¦å“ªäº›ç±»å‹çš„ Lead
3. ç¡®å®šä¾èµ–å…³ç³»å’Œæ‰§è¡Œé¡ºåº
4. åˆ¶å®šè·¨ç»„æ¥å£çº¦å®š
5. åˆ†é…ä»»åŠ¡"
```

---

## åä¸€ã€é…ç½®æ–‡ä»¶æ€»è§ˆ

### 11.1 ä¸»é…ç½®

```yaml
# config/default.yaml

app:
  name: "AICO"
  version: "0.1.0"
  data_dir: "/app/data"
  log_level: "info"

agent:
  max_loop_iterations: 50
  default_timeout: 300

mcp_servers:
  terminal:
    transport: "stdio"
    command: "node"
    args: ["./packages/mcp-terminal/dist/index.js"]

# å¼•ç”¨ç‹¬ç«‹é…ç½®æ–‡ä»¶
security: !include security.yaml
llm: !include llm.yaml
agents: !include agents.yaml
memory: !include memory.yaml
access: !include access.yaml
plugins: !include plugins.yaml
```

### 11.2 å®‰å…¨é…ç½®ï¼ˆå®¹å™¨å†…ç®€åŒ–ç‰ˆï¼‰

```yaml
# config/security.yaml

command_filter:
  mode: "blacklist"
  blacklist_patterns:
    - ':\(\)\{.*\};'               # fork bomb
    - 'rm\s+-rf\s+/'               # åˆ é™¤æ ¹ç›®å½•
    - 'mkfs\.'                     # æ ¼å¼åŒ–ç£ç›˜
    - 'dd\s+if='                   # ç£ç›˜å†™å…¥

confirmation:
  enabled: true
  always_confirm:
    - pattern: '\brm\b.*-r'
      message: "å°†è¦é€’å½’åˆ é™¤æ–‡ä»¶"
    - pattern: '\bgit\s+push\b'
      message: "å°†è¦æ¨é€ä»£ç åˆ°è¿œç¨‹ä»“åº“"
    - pattern: '\bcurl\b.*-X\s*POST'
      message: "å°†è¦å‘é€ HTTP POST è¯·æ±‚"
    - pattern: '\bssh\b'
      message: "å°†è¦å»ºç«‹ SSH è¿æ¥"
  auto_approve:
    - 'ls', 'cat', 'pwd', 'echo', 'date', 'whoami'
    - 'cd', 'head', 'tail', 'grep', 'find', 'wc'
    - 'git status', 'git log', 'git diff'

audit:
  enabled: true
  log_dir: "/app/data/audit"
  log_commands: true
  log_output: true
  log_rotation: "daily"
```

### 11.3 Agent å±‚çº§é…ç½®

```yaml
# config/agents.yaml

hierarchy:
  max_leads_per_commander: 7
  max_workers_per_lead: 7
  max_total_agents: 50

commander:
  llm_model: "claude-opus"
  context_window: 32000
  compression_threshold: 24000
  long_term_memory_recall: 10
  recent_history_keep: 5

lead:
  llm_model: "claude-sonnet"
  context_window: 16000
  compression_threshold: 12000
  long_term_memory_recall: 5
  recent_history_keep: 3
  idle_timeout_sec: 300

worker:
  llm_model: "claude-haiku"
  context_window: 8000
  compression_threshold: 6000
  long_term_memory_recall: 3
  recent_history_keep: 2
```

### 11.4 è®°å¿†é…ç½®

```yaml
# config/memory.yaml

short_term:
  compression:
    zone_a_strategy: "llm_summary"
    zone_b_strategy: "rule_based"
    zone_c_strategy: "keep_full"
    output_simplification:
      max_output_chars: 500
      keep_head_chars: 200
      keep_tail_chars: 200
      success_simplify: true
      failure_keep_full: true
      list_aggregate_threshold: 50
    merge_repeated:
      enabled: true
      min_repeat_count: 3

working_memory:
  max_recent_actions:
    commander: 30
    lead: 20
    worker: 10
  snapshot_update: "incremental"

long_term:
  storage: "sqlite"
  db_path: "/app/data/memory.db"
  max_entries: 10000
  importance:
    use_llm_scoring: true
    rule_bonuses:
      user_preference: 0.3
      contains_always_never: 0.2
      one_time_info: -0.3
    min_importance_to_store: 0.2
    dynamic_adjustment:
      used_bonus: 0.05
      unused_penalty: -0.02
  forgetting:
    enabled: true
    check_interval: "weekly"
    forget_threshold: 10.0
    protected_types: ["user_preference"]
    archive_before_delete: true
    archive_retention_days: 30
  merging:
    enabled: true
    similarity_threshold: 0.8
    method: "keyword"
```

### 11.5 æ¥å…¥å±‚é…ç½®

```yaml
# config/access.yaml

web_ui:
  enabled: true
  port: 3000
  host: "0.0.0.0"
  auth:
    enabled: false
  features:
    embedded_terminal: true
    memory_browser: true
    plugin_manager: true
    settings_editor: true

ssh:
  enabled: true
  port: 2222
  host: "0.0.0.0"
  auth:
    type: "password"
    password: "${AICO_SSH_PASSWORD}"
  host_key_path: "/app/config/ssh/host_key"
  sftp:
    enabled: true
    root: "/workspace"
  shell:
    enabled: true
    default_shell: "/bin/bash"

cli:
  enabled: true

im:
  gateway:
    enabled: true
    webhook_base_path: "/im"
  common:
    typing_indicator: true
    confirmation_timeout_sec: 60
    auto_reject_on_timeout: true
    sensitive_filter:
      enabled: true
      patterns:
        - '(?i)(password|passwd|secret|token|api.?key)\s*[:=]\s*\S+'
        - '-----BEGIN .* PRIVATE KEY-----'
      replacement: "[å·²è„±æ•]"
    restricted_operations:
      - pattern: 'rm\s+-rf'
        message: "æ­¤æ“ä½œä¸å…è®¸é€šè¿‡ IM æ‰§è¡Œï¼Œè¯·ä½¿ç”¨ Web UI æˆ– SSH"
  user_management:
    default_role: "user"
    admins:
      telegram: []
      slack: []
      discord: []
  platforms:
    telegram:
      enabled: false
      bot_token: "${TELEGRAM_BOT_TOKEN}"
      mode: "polling"
      allowed_users: []
    slack:
      enabled: false
      bot_token: "${SLACK_BOT_TOKEN}"
      app_token: "${SLACK_APP_TOKEN}"
      signing_secret: "${SLACK_SIGNING_SECRET}"
      mode: "socket"
      respond_to_mention_only: true
    discord:
      enabled: false
      bot_token: "${DISCORD_BOT_TOKEN}"
      respond_to_mention_only: true
      use_threads: true

sessions:
  max_concurrent: 10
  idle_timeout_minutes: 60
  share_between_access: true
```

---

## åäºŒã€å®Œæ•´æ¥å£æ€»è§ˆ

```
Layer 1 â€” Container Runtime:
  â”œâ”€â”€ EnvironmentProvider              ç¯å¢ƒä¿¡æ¯å’Œå·¥å…·æ£€æµ‹
  â””â”€â”€ ContainerManager                 å®¹å™¨å¥åº·å’Œç”Ÿå‘½å‘¨æœŸ

Layer 2 â€” MCP Services:
  â”œâ”€â”€ MCPServerProvider                MCP Server æ ‡å‡†æ¥å£ (å¯æ‰©å±•)
  â””â”€â”€ MCPServerRegistry                Server æ³¨å†Œå’Œå‘ç°

Layer 3 â€” Agent Core:
  â”œâ”€â”€ MemoryBackend                    è®°å¿†å­˜å‚¨åç«¯ (å¯æ›¿æ¢)
  â”œâ”€â”€ CompressionStrategy              å‹ç¼©ç­–ç•¥ (å¯æ›¿æ¢)
  â”œâ”€â”€ ImportanceScorer                 é‡è¦æ€§è¯„åˆ† (å¯æ›¿æ¢)
  â”œâ”€â”€ ForgettingPolicy                 é—å¿˜ç­–ç•¥ (å¯æ›¿æ¢)
  â”œâ”€â”€ SecurityPolicy                   å®‰å…¨ç­–ç•¥ (å¯æ›¿æ¢/å¯å åŠ )
  â”œâ”€â”€ ContextHook                      ä¸Šä¸‹æ–‡æ„å»ºé’©å­ (å¯å åŠ )
  â””â”€â”€ AgentLifecycleHook               Agent ç”Ÿå‘½å‘¨æœŸé’©å­ (å¯å åŠ )

Layer 4 â€” LLM API:
  â”œâ”€â”€ LLMProvider                      å¤§æ¨¡å‹æä¾›å•† (å¯æ‰©å±•)
  â”œâ”€â”€ RoutingStrategy                  æ¨¡å‹è·¯ç”±ç­–ç•¥ (å¯æ›¿æ¢)
  â””â”€â”€ LLMMiddleware                    LLM è°ƒç”¨ä¸­é—´ä»¶ (å¯å åŠ )

Layer 5 â€” Agent Hierarchy:
  â”œâ”€â”€ ModeDefinition                   ç»„ç»‡æ¨¡å¼å®šä¹‰ (å¯æ‰©å±•)
  â”œâ”€â”€ ModeRegistry                     æ¨¡å¼æ³¨å†Œå’Œå‘ç°
  â”œâ”€â”€ DecompositionStrategy            ä»»åŠ¡åˆ†è§£ç­–ç•¥ (å¯æ›¿æ¢)
  â”œâ”€â”€ SchedulingStrategy               è°ƒåº¦ç­–ç•¥ (å¯æ›¿æ¢)
  â”œâ”€â”€ QualityGate                      è´¨é‡é—¨æ§ (å¯å åŠ )
  â””â”€â”€ CollaborationHook                åä½œæµç¨‹é’©å­ (å¯å åŠ )

Layer 6 â€” Access Layer:
  â”œâ”€â”€ AccessProvider                   æ¥å…¥æ–¹å¼æä¾›è€… (å¯æ‰©å±•)
  â”œâ”€â”€ AICOCore                         å†…æ ¸å…¥å£ (æ‰€æœ‰æ¥å…¥å…±ç”¨)
  â”œâ”€â”€ SessionEventBus                  ä¼šè¯äº‹ä»¶æ€»çº¿ (å¤šç«¯åŒæ­¥)
  â”œâ”€â”€ IMGatewayProvider                IM ç½‘å…³ (AccessProvider å®ç°)
  â”œâ”€â”€ IMPlatformAdapter                IM å¹³å°é€‚é…å™¨ (å¯æ‰©å±•)
  â”œâ”€â”€ IMAdapter                        IM é€šç”¨é€‚é…æŠ½è±¡ç±»
  â””â”€â”€ IMUserManager                    IM ç”¨æˆ·æƒé™ç®¡ç†

Cross-Layer â€” Plugin System:
  â”œâ”€â”€ AICOPlugin                       æ’ä»¶å…¥å£æ¥å£
  â””â”€â”€ PluginContext                    æ’ä»¶ä¸Šä¸‹æ–‡ (è®¿é—®æ‰€æœ‰æ³¨å†Œè¡¨)
```

---

## åä¸‰ã€é¡¹ç›®ç»“æ„

```
aico/
â”‚
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile                       # ä¸»é•œåƒ
â”‚   â”œâ”€â”€ docker-compose.yml               # ç”Ÿäº§æ¨¡å¼
â”‚   â”œâ”€â”€ docker-compose.dev.yml           # å¼€å‘æ¨¡å¼
â”‚   â”œâ”€â”€ entrypoint.sh                    # å®¹å™¨å…¥å£
â”‚   â””â”€â”€ tools/                           # é¢„è£…å·¥å…·å®‰è£…è„šæœ¬
â”‚       â”œâ”€â”€ install-node.sh
â”‚       â”œâ”€â”€ install-python.sh
â”‚       â””â”€â”€ install-common.sh
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ default.yaml                     # ä¸»é…ç½®
â”‚   â”œâ”€â”€ security.yaml                    # å®‰å…¨ç­–ç•¥
â”‚   â”œâ”€â”€ llm.yaml                         # æ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ agents.yaml                      # Agent å±‚çº§é…ç½®
â”‚   â”œâ”€â”€ memory.yaml                      # è®°å¿†å‹ç¼©é…ç½®
â”‚   â”œâ”€â”€ access.yaml                      # æ¥å…¥å±‚é…ç½®
â”‚   â”œâ”€â”€ plugins.yaml                     # æ’ä»¶é…ç½®
â”‚   â””â”€â”€ modes/                           # æ¨¡å¼å®šä¹‰
â”‚       â”œâ”€â”€ tech-team.yaml
â”‚       â”œâ”€â”€ research-team.yaml
â”‚       â”œâ”€â”€ project-management.yaml
â”‚       â”œâ”€â”€ creative-team.yaml
â”‚       â”œâ”€â”€ ops-team.yaml
â”‚       â”œâ”€â”€ education-team.yaml
â”‚       â”œâ”€â”€ data-team.yaml
â”‚       â””â”€â”€ custom/                      # ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å¼
â”‚
â”œâ”€â”€ packages/
â”‚   â”‚
â”‚   â”œâ”€â”€ core-interfaces/                 # â˜… æ‰€æœ‰æ¥å£å®šä¹‰ (çº¯ç±»å‹ï¼Œé›¶å®ç°)
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts                 # ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚       â”œâ”€â”€ layer1/
â”‚   â”‚       â”‚   â”œâ”€â”€ environment-provider.ts
â”‚   â”‚       â”‚   â””â”€â”€ container-manager.ts
â”‚   â”‚       â”œâ”€â”€ layer2/
â”‚   â”‚       â”‚   â”œâ”€â”€ mcp-server-provider.ts
â”‚   â”‚       â”‚   â””â”€â”€ mcp-server-registry.ts
â”‚   â”‚       â”œâ”€â”€ layer3/
â”‚   â”‚       â”‚   â”œâ”€â”€ memory-backend.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ compression-strategy.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ importance-scorer.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ forgetting-policy.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ security-policy.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ context-hook.ts
â”‚   â”‚       â”‚   â””â”€â”€ agent-lifecycle-hook.ts
â”‚   â”‚       â”œâ”€â”€ layer4/
â”‚   â”‚       â”‚   â”œâ”€â”€ llm-provider.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ routing-strategy.ts
â”‚   â”‚       â”‚   â””â”€â”€ llm-middleware.ts
â”‚   â”‚       â”œâ”€â”€ layer5/
â”‚   â”‚       â”‚   â”œâ”€â”€ mode-definition.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ mode-registry.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ decomposition-strategy.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ scheduling-strategy.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ quality-gate.ts
â”‚   â”‚       â”‚   â””â”€â”€ collaboration-hook.ts
â”‚   â”‚       â”œâ”€â”€ layer6/
â”‚   â”‚       â”‚   â”œâ”€â”€ access-provider.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ aico-core.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ session-event-bus.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ im-adapter.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ im-gateway.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ im-user-manager.ts
â”‚   â”‚       â”‚   â””â”€â”€ im-types.ts
â”‚   â”‚       â””â”€â”€ plugin/
â”‚   â”‚           â”œâ”€â”€ aico-plugin.ts
â”‚   â”‚           â””â”€â”€ plugin-context.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ plugin-system/                   # æ’ä»¶åŠ è½½å’Œç®¡ç†
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ plugin-loader.ts
â”‚   â”‚       â”œâ”€â”€ plugin-manager.ts
â”‚   â”‚       â”œâ”€â”€ plugin-validator.ts
â”‚   â”‚       â””â”€â”€ registry-hub.ts          # æ‰€æœ‰æ³¨å†Œè¡¨ç»Ÿä¸€å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ aico-core/                       # AICO å†…æ ¸
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ core.ts                  # AICOCore å®ç°
â”‚   â”‚       â”œâ”€â”€ session-manager.ts
â”‚   â”‚       â”œâ”€â”€ event-bus.ts
â”‚   â”‚       â””â”€â”€ bootstrap.ts             # ç³»ç»Ÿå¯åŠ¨ç¼–æ’
â”‚   â”‚
â”‚   â”œâ”€â”€ multi-agent/                     # å¤š Agent å±‚çº§ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ hierarchy/
â”‚   â”‚       â”‚   â”œâ”€â”€ commander.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ lead.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ worker.ts
â”‚   â”‚       â”‚   â””â”€â”€ agent-factory.ts
â”‚   â”‚       â”œâ”€â”€ modes/
â”‚   â”‚       â”‚   â”œâ”€â”€ mode-registry-impl.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ mode-selector.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ mode-loader.ts
â”‚   â”‚       â”‚   â””â”€â”€ mode-mixer.ts
â”‚   â”‚       â”œâ”€â”€ orchestration/
â”‚   â”‚       â”‚   â”œâ”€â”€ llm-decomposition.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ dag-scheduler.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ parallel-executor.ts
â”‚   â”‚       â”‚   â””â”€â”€ result-aggregator.ts
â”‚   â”‚       â””â”€â”€ communication/
â”‚   â”‚           â”œâ”€â”€ message-bus.ts
â”‚   â”‚           â”œâ”€â”€ message-types.ts
â”‚   â”‚           â””â”€â”€ escalation.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ agent-core/                      # å•ä½“ Agent å¼•æ“
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ agent-loop.ts
â”‚   â”‚       â”œâ”€â”€ memory/
â”‚   â”‚       â”‚   â”œâ”€â”€ working-memory.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ short-term-memory.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ long-term-memory.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ backends/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ json-backend.ts
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ sqlite-backend.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ compression/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ three-zone-strategy.ts
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ summary-generator.ts
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ output-simplifier.ts
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ duplicate-merger.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ scoring/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ hybrid-scorer.ts
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ llm-scorer.ts
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ rule-scorer.ts
â”‚   â”‚       â”‚   â””â”€â”€ forgetting/
â”‚   â”‚       â”‚       â””â”€â”€ score-based-policy.ts
â”‚   â”‚       â”œâ”€â”€ conversation/
â”‚   â”‚       â”‚   â”œâ”€â”€ context-builder.ts
â”‚   â”‚       â”‚   â””â”€â”€ token-budget.ts
â”‚   â”‚       â””â”€â”€ security/
â”‚   â”‚           â”œâ”€â”€ container-relaxed.ts
â”‚   â”‚           â””â”€â”€ network-guard.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ llm-client/                      # LLM å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ providers/
â”‚   â”‚       â”‚   â”œâ”€â”€ claude.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ openai.ts
â”‚   â”‚       â”‚   â””â”€â”€ ollama.ts
â”‚   â”‚       â”œâ”€â”€ routing/
â”‚   â”‚       â”‚   â”œâ”€â”€ level-based.ts
â”‚   â”‚       â”‚   â””â”€â”€ fallback.ts
â”‚   â”‚       â”œâ”€â”€ middleware/
â”‚   â”‚       â”‚   â”œâ”€â”€ retry.ts
â”‚   â”‚       â”‚   â””â”€â”€ logging.ts
â”‚   â”‚       â””â”€â”€ llm-manager.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ mcp-terminal/                    # MCP ç»ˆç«¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â”œâ”€â”€ tools/
â”‚   â”‚       â”‚   â”œâ”€â”€ execute-command.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ run-script.ts
â”‚   â”‚       â”‚   â””â”€â”€ session-tools.ts
â”‚   â”‚       â”œâ”€â”€ backends/
â”‚   â”‚       â”‚   â”œâ”€â”€ subprocess.ts
â”‚   â”‚       â”‚   â””â”€â”€ pty.ts
â”‚   â”‚       â”œâ”€â”€ security/
â”‚   â”‚       â”‚   â”œâ”€â”€ command-filter.ts
â”‚   â”‚       â”‚   â””â”€â”€ resource-limiter.ts
â”‚   â”‚       â”œâ”€â”€ session/
â”‚   â”‚       â”‚   â””â”€â”€ session-manager.ts
â”‚   â”‚       â””â”€â”€ utils/
â”‚   â”‚           â”œâ”€â”€ ansi-cleaner.ts
â”‚   â”‚           â”œâ”€â”€ output-truncator.ts
â”‚   â”‚           â””â”€â”€ audit-logger.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ container-runtime/               # å®¹å™¨è¿è¡Œæ—¶
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ environment-detector.ts
â”‚   â”‚       â””â”€â”€ container-health.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ web-ui/                          # Web UI
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ server/
â”‚   â”‚       â”‚   â”œâ”€â”€ http-server.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ websocket.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ api-routes.ts
â”‚   â”‚       â”‚   â””â”€â”€ provider.ts
â”‚   â”‚       â””â”€â”€ client/
â”‚   â”‚           â”œâ”€â”€ index.html
â”‚   â”‚           â”œâ”€â”€ chat.js
â”‚   â”‚           â”œâ”€â”€ agent-tree.js
â”‚   â”‚           â”œâ”€â”€ memory-browser.js
â”‚   â”‚           â”œâ”€â”€ terminal.js
â”‚   â”‚           â”œâ”€â”€ settings.js
â”‚   â”‚           â””â”€â”€ styles.css
â”‚   â”‚
â”‚   â”œâ”€â”€ ssh-server/                      # SSH æœåŠ¡
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ provider.ts
â”‚   â”‚       â”œâ”€â”€ ssh-server.ts
â”‚   â”‚       â”œâ”€â”€ auth.ts
â”‚   â”‚       â”œâ”€â”€ sftp-handler.ts
â”‚   â”‚       â”œâ”€â”€ cli-renderer.ts
â”‚   â”‚       â””â”€â”€ command-parser.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                             # æœ¬åœ° CLI
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ provider.ts
â”‚   â”‚       â”œâ”€â”€ chat-ui.ts
â”‚   â”‚       â”œâ”€â”€ agent-status.ts
â”‚   â”‚       â”œâ”€â”€ tool-display.ts
â”‚   â”‚       â”œâ”€â”€ confirmation-ui.ts
â”‚   â”‚       â”œâ”€â”€ command-parser.ts
â”‚   â”‚       â””â”€â”€ mode-display.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ im-gateway/                      # IM ç½‘å…³
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ gateway.ts
â”‚   â”‚       â”œâ”€â”€ im-adapter-base.ts
â”‚   â”‚       â”œâ”€â”€ user-manager.ts
â”‚   â”‚       â”œâ”€â”€ webhook-router.ts
â”‚   â”‚       â””â”€â”€ sensitive-filter.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ im-telegram/                     # Telegram é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ adapter.ts
â”‚   â”‚       â”œâ”€â”€ message-formatter.ts
â”‚   â”‚       â””â”€â”€ provider.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ im-slack/                        # Slack é€‚é…å™¨
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ adapter.ts
â”‚   â”‚       â”œâ”€â”€ block-builder.ts
â”‚   â”‚       â””â”€â”€ provider.ts
â”‚   â”‚
â”‚   â””â”€â”€ im-discord/                      # Discord é€‚é…å™¨
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ adapter.ts
â”‚           â”œâ”€â”€ embed-builder.ts
â”‚           â””â”€â”€ provider.ts
â”‚
â”œâ”€â”€ plugins/                             # æ’ä»¶ç›®å½• (Volume)
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md                  # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ plugin-development.md            # æ’ä»¶å¼€å‘æŒ‡å—
â”‚   â”œâ”€â”€ interface-reference.md           # æ¥å£å‚è€ƒ
â”‚   â”œâ”€â”€ web-ui-guide.md                  # Web UI æŒ‡å—
â”‚   â”œâ”€â”€ ssh-guide.md                     # SSH è¿æ¥æŒ‡å—
â”‚   â”œâ”€â”€ im-guide.md                      # IM å¯¹æ¥æŒ‡å—
â”‚   â”œâ”€â”€ modes.md                         # æ¨¡å¼ç³»ç»Ÿæ–‡æ¡£
â”‚   â”œâ”€â”€ multi-agent.md                   # å¤š Agent æ–‡æ¡£
â”‚   â”œâ”€â”€ memory-compression.md            # è®°å¿†å‹ç¼©æ–‡æ¡£
â”‚   â”œâ”€â”€ docker-guide.md                  # Docker ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ security-model.md               # å®‰å…¨æ¨¡å‹æ–‡æ¡£
â”‚
â””â”€â”€ scripts/
    â”œâ”€â”€ build.sh
    â”œâ”€â”€ dev.sh
    â”œâ”€â”€ docker-build.sh
    â””â”€â”€ docker-run.sh
```

---

## åå››ã€ç³»ç»Ÿå¯åŠ¨æµç¨‹

```
Docker å®¹å™¨å¯åŠ¨
    â”‚
    â–¼
entrypoint.sh
    â”œâ”€â”€ æ£€æŸ¥ Volume åˆå§‹åŒ– (config/data/plugins)
    â”œâ”€â”€ æ£€æŸ¥ç¯å¢ƒå˜é‡ (API Key)
    â”œâ”€â”€ ç”Ÿæˆ SSH ä¸»æœºå¯†é’¥ (å¦‚æœä¸å­˜åœ¨)
    â”œâ”€â”€ ç”Ÿæˆ SSH å¯†ç  (å¦‚æœ auto)
    â””â”€â”€ å¯åŠ¨ Node.js ä¸»è¿›ç¨‹
          â”‚
          â–¼
bootstrap.ts â€” ç³»ç»Ÿå¯åŠ¨ç¼–æ’
    â”‚
    â”œâ”€â”€ 1. åŠ è½½é…ç½®æ–‡ä»¶
    â”‚
    â”œâ”€â”€ 2. åˆå§‹åŒ– Plugin System
    â”‚     â””â”€â”€ æ‰«ææ’ä»¶ â†’ åŠ è½½ manifest â†’ éªŒè¯ä¾èµ–
    â”‚
    â”œâ”€â”€ 3. åˆå§‹åŒ– RegistryHub
    â”‚
    â”œâ”€â”€ 4. æ³¨å†Œå†…ç½®ç»„ä»¶ (ä¸æ’ä»¶èµ°ç›¸åŒæµç¨‹)
    â”‚     â”œâ”€â”€ Layer 1: EnvironmentProvider
    â”‚     â”œâ”€â”€ Layer 2: mcp-terminal
    â”‚     â”œâ”€â”€ Layer 3: sqlite-backend, three-zone-strategy, ...
    â”‚     â”œâ”€â”€ Layer 4: claude-provider, level-based-routing, ...
    â”‚     â”œâ”€â”€ Layer 5: å†…ç½®æ¨¡å¼
    â”‚     â””â”€â”€ Layer 6: WebUI, SSH, CLI, IM Gateway
    â”‚
    â”œâ”€â”€ 5. æ¿€æ´»æ‰€æœ‰æ’ä»¶ (plugin.activate())
    â”‚
    â”œâ”€â”€ 6. åˆå§‹åŒ– AICOCore
    â”‚     â”œâ”€â”€ è¿æ¥æ‰€æœ‰å±‚ç»„ä»¶
    â”‚     â”œâ”€â”€ åˆå§‹åŒ– Commander Agent
    â”‚     â”œâ”€â”€ åŠ è½½é•¿æœŸè®°å¿†
    â”‚     â””â”€â”€ æ¢å¤ä¼šè¯å¿«ç…§ (å¦‚æœæœ‰)
    â”‚
    â”œâ”€â”€ 7. å¯åŠ¨æ¥å…¥å±‚
    â”‚     â”œâ”€â”€ WebUIProvider.start()      â†’ :3000
    â”‚     â”œâ”€â”€ SSHProvider.start()        â†’ :2222
    â”‚     â”œâ”€â”€ CLIProvider.start()        â†’ stdin
    â”‚     â””â”€â”€ IMGateway.start()
    â”‚           â”œâ”€â”€ TelegramAdapter.connect()
    â”‚           â”œâ”€â”€ SlackAdapter.connect()
    â”‚           â””â”€â”€ ...
    â”‚
    â””â”€â”€ 8. è¾“å‡ºå¯åŠ¨ä¿¡æ¯
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  AICO started successfully!                       â”‚
          â”‚                                                   â”‚
          â”‚  Access:                                          â”‚
          â”‚    Web UI:    http://localhost:3000                â”‚
          â”‚    SSH:       ssh aico@localhost -p 2222           â”‚
          â”‚               Password: a3xK9mPq                  â”‚
          â”‚    CLI:       docker attach aico                  â”‚
          â”‚                                                   â”‚
          â”‚  IM Bots:                                         â”‚
          â”‚    Telegram:  @YourAICOBot âœ… connected            â”‚
          â”‚    Slack:     â¬š not configured                    â”‚
          â”‚    Discord:   â¬š not configured                    â”‚
          â”‚                                                   â”‚
          â”‚  Plugins:  3 loaded                               â”‚
          â”‚  Modes:    7 available                            â”‚
          â”‚  Memory:   127 entries                            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åäº”ã€Docker é…ç½®

```yaml
# docker-compose.yml

services:
  aico:
    build: ./docker
    container_name: aico
    ports:
      - "3000:3000"      # Web UI + IM Webhook
      - "2222:2222"      # SSH
    volumes:
      - aico-config:/app/config
      - aico-data:/app/data
      - aico-plugins:/app/plugins
      - ./workspace:/workspace
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - AICO_SSH_PASSWORD=${AICO_SSH_PASSWORD:-auto}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN:-}
      - SLACK_APP_TOKEN=${SLACK_APP_TOKEN:-}
      - SLACK_SIGNING_SECRET=${SLACK_SIGNING_SECRET:-}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN:-}
    restart: unless-stopped

volumes:
  aico-config:
  aico-data:
  aico-plugins:
```

---

## åå…­ã€å¼€å‘è·¯çº¿å›¾

```
Phase 1: éª¨æ¶ + å• Agent + CLI (Week 1-3)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ¦ core-interfaces â€” å®šä¹‰å…¨éƒ¨ 6 å±‚æ ¸å¿ƒæ¥å£
  âœ¦ plugin-system â€” æ’ä»¶åŠ è½½ + RegistryHub
  âœ¦ Docker â€” Dockerfile + compose + entrypoint
  âœ¦ container-runtime â€” EnvironmentProvider
  âœ¦ mcp-terminal â€” execute_command + run_script + åŸºç¡€å®‰å…¨
  âœ¦ llm-client â€” Claude Provider
  âœ¦ agent-core â€” æœ€ç®€ AgentLoop + å·¥ä½œè®°å¿† + åŸºç¡€ ContextBuilder
  âœ¦ aico-core â€” AICOCore + SessionManager + EventBus + bootstrap
  âœ¦ cli â€” åŸºç¡€å¯¹è¯ + /help + /status + /exec + /shell

  é‡Œç¨‹ç¢‘: docker compose up â†’ CLI å¯¹è¯ â†’ AI æ“ä½œå®¹å™¨
         æ‰€æœ‰ç»„ä»¶é€šè¿‡æ¥å£æ³¨å†Œï¼Œè€Œéç¡¬ç¼–ç 

Phase 2: SSH + è®°å¿†å‹ç¼© (Week 4-6)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ¦ ssh-server â€” ssh2 æœåŠ¡ç«¯ + è®¤è¯ + SFTP + /shell
  âœ¦ çŸ­æœŸè®°å¿†å‹ç¼© â€” ä¸‰åŒºæ¨¡å‹ + Token é¢„ç®—
  âœ¦ é•¿æœŸè®°å¿† â€” SQLite + é‡è¦æ€§è¯„åˆ† + é—å¿˜ + åˆå¹¶
  âœ¦ å·¥ä½œè®°å¿†å‹ç¼© â€” æ»‘åŠ¨çª—å£ + ç¯å¢ƒå¿«ç…§
  âœ¦ ä¼šè¯å¿«ç…§ â€” å®¹å™¨é‡å»ºåæ¢å¤
  âœ¦ å‘½ä»¤ä½“ç³» â€” /memory + /session ç³»åˆ—

  é‡Œç¨‹ç¢‘: SSH è¿æ¥ + é•¿å¯¹è¯ä¸å´©æºƒ + è·¨ä¼šè¯è®°å¿†

Phase 3: Web UI + æ¨¡å¼ç³»ç»Ÿ (Week 7-10)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ¦ web-ui â€” HTTP + WebSocket + å®Œæ•´å‰ç«¯
    ä¸»å¯¹è¯åŒº + Agent é¢æ¿ + è®°å¿†æµè§ˆå™¨ + å†…åµŒç»ˆç«¯ + è®¾ç½®
  âœ¦ multi-agent (ä¸¤çº§) â€” Commander + Lead
    ModeRegistry + æ¨¡å¼é€‰æ‹© + æ··åˆæ¨¡å¼
    2~3 ç§å†…ç½®æ¨¡å¼ (tech_team, research_team, creative_team)
    DAG è°ƒåº¦ + ä¸²è¡Œæ‰§è¡Œ
  âœ¦ LLM è·¯ç”± â€” Commander/Lead ç”¨ä¸åŒæ¨¡å‹

  é‡Œç¨‹ç¢‘: æµè§ˆå™¨ä½¿ç”¨ + ä¸­ç­‰ä»»åŠ¡å¤š Agent å®Œæˆ

Phase 4: IM å¯¹æ¥ + å®Œæ•´ä¸‰çº§ Agent (Week 11-14)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ¦ im-gateway â€” IM ç½‘å…³ + IMAdapter æŠ½è±¡ç±» + é€šç”¨é€»è¾‘
  âœ¦ im-telegram â€” ç¬¬ä¸€ä¸ª IM å¹³å°
  âœ¦ im-slack â€” ç¬¬äºŒä¸ª IM å¹³å°
  âœ¦ im-discord â€” ç¬¬ä¸‰ä¸ª IM å¹³å°
  âœ¦ multi-agent (å®Œæ•´) â€” Worker å±‚ + å¹¶è¡Œæ‰§è¡Œ + å…¨éƒ¨å†…ç½®æ¨¡å¼
  âœ¦ é”™è¯¯å¤„ç† â€” ä¸‰çº§å‡çº§æœºåˆ¶
  âœ¦ æ’ä»¶ç³»ç»Ÿå®Œå–„ â€” /plugin å‘½ä»¤ + Web UI ç®¡ç†

  é‡Œç¨‹ç¢‘: IM æœºå™¨äºº + å¤æ‚ä»»åŠ¡è·¨æ¨¡å¼åä½œ

Phase 5: ç”Ÿæ€ä¸ä¼˜åŒ– (Week 15+)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â–¡ æ’ä»¶å¼€å‘æ–‡æ¡£ + ç¤ºä¾‹æ’ä»¶
  â–¡ ç¤¾åŒº IM æ’ä»¶ (é£ä¹¦/é’‰é’‰/ä¼ä¸šå¾®ä¿¡/Matrix)
  â–¡ æ›´å¤š MCP Server (filesystem/browser/desktop)
  â–¡ æ›´å¤š LLM Provider (OpenAI/Ollama/Gemini/DeepSeek)
  â–¡ å‘é‡æœç´¢è®°å¿†åç«¯
  â–¡ Web UI ç§»åŠ¨ç«¯å“åº”å¼
  â–¡ å¤šç”¨æˆ·å®Œå–„ (Web UI è®¤è¯ + IM æƒé™)
  â–¡ æ€§èƒ½ç›‘æ§ (Token æ¶ˆè€—/ä»»åŠ¡è€—æ—¶)
  â–¡ ç”¨æˆ·è‡ªå®šä¹‰ Agent è§’è‰²å’Œæ¨¡å¼
  â–¡ REST API Provider (ç¨‹åºåŒ–è°ƒç”¨ AICO)
```

---

## åä¸ƒã€å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourname/aico.git
cd aico

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ API Key

# 3. å¯åŠ¨
docker compose up -d

# 4. ä½¿ç”¨
# æ–¹å¼ A: æµè§ˆå™¨
open http://localhost:3000

# æ–¹å¼ B: SSH
ssh aico@localhost -p 2222

# æ–¹å¼ C: CLI
docker attach aico

# 5. ç¯å¢ƒæŸåæ¢å¤
docker compose down && docker compose up -d

# 6. å®Œå…¨é‡ç½®
docker compose down -v && docker compose up -d
```

---

## åå…«ã€å…³é”®è®¾è®¡å†³ç­–æ€»ç»“

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| **ç³»ç»Ÿå®šä½** | å¼€æ”¾å¹³å°ï¼Œæ¯å±‚æœ‰æ¥å£ | å†…ç½®åŠŸèƒ½ä¸ç¬¬ä¸‰æ–¹æ’ä»¶å¹³ç­‰ |
| **æ¥å£ä¸å®ç°åˆ†ç¦»** | `core-interfaces` çº¯æ¥å£åŒ… | å¤–éƒ¨å¼€å‘è€…åªä¾èµ–æ¥å£åŒ… |
| **è¿è¡Œç¯å¢ƒ** | æ•´ä¸ªé¡¹ç›®åœ¨ Docker ä¸­ | åäº†å°±æ‰”ï¼Œå®‰å…¨ç®€å• |
| **æ•°æ®æŒä¹…åŒ–** | Volume æŒ‚è½½ config/data/plugins/workspace | å®¹å™¨å¯é”€æ¯ï¼Œæ•°æ®ä¿ç•™ |
| **å®‰å…¨ç­–ç•¥** | å®¹å™¨å†…å®½æ¾ï¼Œä»…é˜²ç½‘ç»œå¤–å‘ | å®¹å™¨å³æ²™ç®± |
| **Agent ç»“æ„** | ä¸‰å±‚ï¼šCommander â†’ Lead (â‰¤7) â†’ Worker (â‰¤7) | å›ºå®šç»“æ„ + çµæ´»è§’è‰² |
| **ç»„ç»‡æ¨¡å¼** | ä¸å›ºå®šè§’è‰²ï¼ŒåŠ¨æ€é€‰æ‹©æ¨¡å¼ | çµæ´»é€‚é…å„ç±»ä»»åŠ¡ |
| **æ··åˆæ¨¡å¼** | ä»å¤šä¸ªæ¨¡å¼æ··é€‰ Lead | çœŸå®ä»»åŠ¡è·¨é¢†åŸŸ |
| **æ¨¡å¼å®šä¹‰** | YAML é…ç½® + ä»£ç æ’ä»¶ | ç®€å•ç”¨ YAMLï¼Œå¤æ‚å†™ä»£ç  |
| **å±‚çº§é€šä¿¡** | ä¸¥æ ¼é€çº§ | èŒè´£æ¸…æ™°ï¼Œæ˜“è¿½æº¯ |
| **çŸ­æœŸè®°å¿†å‹ç¼©** | ä¸‰åŒºæ¨¡å‹ (æ‘˜è¦/ç²¾ç®€/ä¿ç•™) | å…¼é¡¾ä¿¡æ¯ä¿ç•™å’Œ Token èŠ‚çœ |
| **å·¥å…·è¾“å‡ºå‹ç¼©** | è§„åˆ™ä¸ºä¸»ï¼Œä¸è°ƒ LLM | é«˜æ•ˆï¼Œä¸æ¶ˆè€—é¢å¤– Token |
| **é•¿æœŸè®°å¿†é—å¿˜** | è¯„åˆ†å…¬å¼ + å½’æ¡£ + å»¶è¿Ÿåˆ é™¤ | å®‰å…¨é—å¿˜ï¼Œå¯æ¢å¤ |
| **è®°å¿†å†™å…¥æƒé™** | Commander/Lead å¯å†™ï¼ŒWorker åªè¯» | é˜²ä½è´¨é‡è®°å¿†æ±¡æŸ“ |
| **LLM æ¨¡å‹åˆ†é…** | Commander å¼º/Lead ä¸­/Worker è½» | é¢„ç®—æœ€ä¼˜åˆ†é… |
| **Agent è¿›ç¨‹æ¨¡å‹** | åŒ Node.js è¿›ç¨‹å†…é€»è¾‘å®ä¾‹ | è½»é‡ï¼Œé›¶é€šä¿¡å¼€é”€ |
| **æ¥å…¥å±‚** | ç‹¬ç«‹ Layer 6ï¼Œæ¥å£åŒ– | ä¸æ ¸å¿ƒè§£è€¦ï¼Œå¯æ‰©å±• |
| **Web UI** | åŒè¿›ç¨‹ HTTP + WebSocket | è½»é‡ï¼Œæ— éœ€é¢å¤–æœåŠ¡ |
| **SSH** | ssh2 åº“ (Node.js å†…) | ä¸ä¾èµ–ç³»ç»Ÿ sshdï¼Œå¯æ§ |
| **IM æ¶æ„** | IMGateway + IMAdapter ä¸¤å±‚ | é€šç”¨é€»è¾‘å¤ç”¨ï¼Œå¹³å°é€»è¾‘éš”ç¦» |
| **IM é€‚é…å™¨** | æŠ½è±¡ç±»è€Œéçº¯æ¥å£ | å¤§é‡é€šç”¨é€»è¾‘å¯ç»§æ‰¿ |
| **å†…ç½® IM** | Telegram + Slack + Discord | è¦†ç›–ä¸ªäºº/ä¼ä¸š/ç¤¾åŒº |
| **IM å®‰å…¨** | è„±æ•è¿‡æ»¤ + æ“ä½œé™åˆ¶ + æƒé™åˆ†çº§ | IM å®‰å…¨æ€§è¾ƒä½ |
| **å¤šç«¯åŒæ­¥** | SessionEventBus | Web/SSH/CLI/IM çŠ¶æ€ä¸€è‡´ |
| **æ’ä»¶ç³»ç»Ÿ** | ç»Ÿä¸€ manifest + ç”Ÿå‘½å‘¨æœŸ | è·¨å±‚æ‰©å±•ï¼Œç®¡ç†ä¸€è‡´ |
| **æ¥å£è¡Œä¸º** | å¯æ›¿æ¢/å¯å åŠ /å¯æ‰©å±• ä¸‰ç±» | ä¸åŒåœºæ™¯ä¸åŒç»„åˆæ–¹å¼ |
| **å…ˆå®šæ¥å£åå®ç°** | Phase 1 å…ˆå®Œæˆ core-interfaces | æ¥å£è®¾è®¡æ˜¯åœ°åŸº |

---

> **æ–‡æ¡£ç‰ˆæœ¬:** v0.5.0
> **æœ€åæ›´æ–°:** 2025å¹´7æœˆ
> **çŠ¶æ€:** æ¶æ„è®¾è®¡å®Œæˆï¼Œå‡†å¤‡è¿›å…¥å¼€å‘é˜¶æ®µ